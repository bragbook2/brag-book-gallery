!function(){"use strict";var t=class{constructor(t,e={}){this.wrapper=t,this.content=t.querySelector(".brag-book-gallery-carousel-content"),this.track=t.querySelector(".brag-book-gallery-carousel-track"),this.prevBtn=t.querySelector('[data-direction="prev"]'),this.nextBtn=t.querySelector('[data-direction="next"]'),this.paginationContainer=t.querySelector(".brag-book-gallery-carousel-pagination"),this.options={itemsPerView:e.itemsPerView||this.getItemsPerView(),gap:e.gap||16,animationDuration:e.animationDuration||.4,slideSelector:e.slideSelector||".brag-book-gallery-carousel-item",infinite:!1!==e.infinite,autoplay:e.autoplay||!1,autoplayDelay:e.autoplayDelay||3e3,pauseOnHover:!1!==e.pauseOnHover,...e},this.isDown=!1,this.startX=0,this.scrollLeft=0,this.currentSlide=0,this.autoplayTimer=null,this.isPaused=!1,this.track&&this.init()}init(){this.createLiveRegion(),this.addShareButtons(),this.setupEventListeners(),this.initializePagination(),this.updateCarouselButtons(),this.updateAriaLabels(),this.options.autoplay&&this.startAutoplay()}addShareButtons(){const t=!this.wrapper.closest(".brag-book-gallery-wrapper");this.track.querySelectorAll(this.options.slideSelector).forEach(e=>{if(!e.querySelector(".brag-book-gallery-carousel-image, img")){const t="https://bragbookgallery.com/nitropack_static/FCmixFCiYNkGgqjxyaUSblqHbCgLrqyJ/assets/images/optimized/rev-407fb37/ngnqwvuungodwrpnrczq.supabase.co/storage/v1/object/sign/brag-photos/org_2vm5nGWtoCYuaQBCP587ez6cYXF/c68b56b086f4f8eef8292f3f23320f1b.Blepharoplasty%20-%20aa239d58-badc-4ded-a26b-f89c2dd059b6.jpg",a=e.querySelector("span");a&&a.remove();const o=e.dataset.caseId;if(o&&""!==o){const a=e.dataset.procedureSlug||"procedure",r=`${window.location.pathname.replace(/\/[^\/]+\/[^\/]+\/?$/,"")}/${a}/${o}/`.replace(/\/+/g,"/"),s=document.createElement("a");s.href=r,s.className="brag-book-gallery-case-card-link",s.dataset.caseId=o;const i=document.createElement("img");i.src=t,i.alt="Before and after result",i.className="brag-book-gallery-carousel-image",i.loading="lazy",s.appendChild(i),e.insertBefore(s,e.firstChild)}else{const a=document.createElement("img");a.src=t,a.alt="Before and after result",a.className="brag-book-gallery-carousel-image",a.loading="lazy",e.insertBefore(a,e.firstChild)}}if(t)return;let a=e.querySelector(".brag-book-gallery-item-actions");if(a||(a=document.createElement("div"),a.className="brag-book-gallery-item-actions",e.appendChild(a)),!a.querySelector(".brag-book-gallery-favorite-button")){const t=e.querySelector(".brag-book-gallery-favorite-button");if(t)a.appendChild(t);else{const t=document.createElement("button");t.className="brag-book-gallery-favorite-button",t.dataset.favorited="false",t.dataset.itemId=e.dataset.slide,t.setAttribute("aria-label","Add to favorites"),t.innerHTML='\n                        <svg fill="rgba(255, 255, 255, 0.5)" stroke="white" stroke-width="2" viewBox="0 0 24 24">\n                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>\n                        </svg>\n                    ',a.appendChild(t)}}if(!a.querySelector(".brag-book-gallery-share-button")&&"undefined"!=typeof bragBookGalleryConfig&&"yes"===bragBookGalleryConfig.enableSharing){const t=document.createElement("button");t.className="brag-book-gallery-share-button",t.dataset.itemId=e.dataset.slide,t.setAttribute("aria-label","Share this image"),t.innerHTML='\n                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">\n                        <path d="M672.22-100q-44.91 0-76.26-31.41-31.34-31.41-31.34-76.28 0-6 4.15-29.16L284.31-404.31q-14.46 15-34.36 23.5t-42.64 8.5q-44.71 0-76.01-31.54Q100-435.39 100-480q0-44.61 31.3-76.15 31.3-31.54 76.01-31.54 22.74 0 42.64 8.5 19.9 8.5 34.36 23.5l284.46-167.08q-2.38-7.38-3.27-14.46-.88-7.08-.88-15.08 0-44.87 31.43-76.28Q627.49-860 672.4-860t76.25 31.44Q780-797.13 780-752.22q0 44.91-31.41 76.26-31.41 31.34-76.28 31.34-22.85 0-42.5-8.69Q610.15-662 595.69-677L311.23-509.54q2.38 7.39 3.27 14.46.88 7.08.88 15.08t-.88 15.08q-.89 7.07-3.27 14.46L595.69-283q14.46-15 34.12-23.69 19.65-8.69 42.5-8.69 44.87 0 76.28 31.43Q780-252.51 780-207.6t-31.44 76.25Q717.13-100 672.22-100Zm.09-60q20.27 0 33.98-13.71Q720-187.42 720-207.69q0-20.27-13.71-33.98-13.71-13.72-33.98-13.72-20.27 0-33.98 13.72-13.72 13.71-13.72 33.98 0 20.27 13.72 33.98Q652.04-160 672.31-160Zm-465-272.31q20.43 0 34.25-13.71 13.83-13.71 13.83-33.98 0-20.27-13.83-33.98-13.82-13.71-34.25-13.71-20.11 0-33.71 13.71Q160-500.27 160-480q0 20.27 13.6 33.98 13.6 13.71 33.71 13.71Zm465-272.3q20.27 0 33.98-13.72Q720-732.04 720-752.31q0-20.27-13.71-33.98Q692.58-800 672.31-800q-20.27 0-33.98 13.71-13.72 13.71-13.72 33.98 0 20.27 13.72 33.98 13.71 13.72 33.98 13.72Zm0 496.92ZM207.69-480Zm464.62-272.31Z"/>\n                    </svg>\n                ',a.appendChild(t)}})}createLiveRegion(){this.liveRegion=document.createElement("div"),this.liveRegion.setAttribute("aria-live","polite"),this.liveRegion.setAttribute("aria-atomic","true"),this.liveRegion.className="sr-only",this.liveRegion.style.position="absolute",this.liveRegion.style.width="1px",this.liveRegion.style.height="1px",this.liveRegion.style.padding="0",this.liveRegion.style.margin="-1px",this.liveRegion.style.overflow="hidden",this.liveRegion.style.clip="rect(0, 0, 0, 0)",this.liveRegion.style.whiteSpace="nowrap",this.liveRegion.style.border="0",this.wrapper.appendChild(this.liveRegion)}setupEventListeners(){this.track.addEventListener("scroll",()=>{this.updateCarouselButtons(),this.updatePagination()}),this.prevBtn&&this.prevBtn.addEventListener("click",()=>{this.navigate("prev"),this.options.autoplay&&(this.stopAutoplay(),this.startAutoplay())}),this.nextBtn&&this.nextBtn.addEventListener("click",()=>{this.navigate("next"),this.options.autoplay&&(this.stopAutoplay(),this.startAutoplay())}),this.track.addEventListener("mousedown",t=>this.handleMouseDown(t)),this.track.addEventListener("mouseleave",()=>this.handleMouseLeave()),this.track.addEventListener("mouseup",()=>this.handleMouseUp()),this.track.addEventListener("mousemove",t=>this.handleMouseMove(t)),this.options.autoplay&&this.options.pauseOnHover&&(this.wrapper.addEventListener("mouseenter",()=>this.pauseAutoplay()),this.wrapper.addEventListener("mouseleave",()=>this.resumeAutoplay())),this.track.addEventListener("wheel",t=>this.handleWheel(t),{passive:!1}),this.track.addEventListener("keydown",t=>this.handleKeydown(t)),this.wrapper.addEventListener("keydown",t=>this.handleKeydown(t)),document.addEventListener("keydown",t=>{this.wrapper.contains(document.activeElement)&&this.handleKeydown(t)}),this.track.tabIndex=0,this.track.setAttribute("aria-label","Use arrow keys to navigate through slides"),this.setupSlideFocusManagement()}handleMouseDown(t){this.isDown=!0,this.track.classList.add("brag-book-gallery-grabbing"),this.startX=t.pageX-this.track.offsetLeft,this.scrollLeft=this.track.scrollLeft}handleMouseLeave(){this.isDown=!1,this.track.classList.remove("brag-book-gallery-grabbing")}handleMouseUp(){this.isDown=!1,this.track.classList.remove("brag-book-gallery-grabbing")}handleMouseMove(t){if(!this.isDown)return;t.preventDefault();const e=2*(t.pageX-this.track.offsetLeft-this.startX);this.track.scrollLeft=this.scrollLeft-e}handleKeydown(t){if("INPUT"===t.target.tagName||"TEXTAREA"===t.target.tagName)return;const e=this.track.querySelectorAll(this.options.slideSelector);if(0===e.length)return;const a=this.getCurrentSlideIndex();let o=!1;switch(t.key){case"ArrowLeft":t.preventDefault(),t.stopPropagation(),this.navigateToSlide(Math.max(0,a-1)),o=!0;break;case"ArrowRight":t.preventDefault(),t.stopPropagation(),this.navigateToSlide(Math.min(e.length-1,a+1)),o=!0;break;case"Home":t.preventDefault(),t.stopPropagation(),this.navigateToSlide(0),o=!0;break;case"End":t.preventDefault(),t.stopPropagation(),this.navigateToSlide(e.length-1),o=!0;break;case"PageUp":t.preventDefault(),t.stopPropagation();const r=this.getItemsPerView();this.navigateToSlide(Math.max(0,a-r)),o=!0;break;case"PageDown":t.preventDefault(),t.stopPropagation();const s=this.getItemsPerView();this.navigateToSlide(Math.min(e.length-1,a+s)),o=!0}o&&document.activeElement!==this.track&&!this.track.contains(document.activeElement)&&this.track.focus(),o&&this.options.autoplay&&(this.stopAutoplay(),this.startAutoplay())}handleWheel(t){t.preventDefault();const e=t.deltaY||t.deltaX,a=Math.abs(e)>50?e:3*e;this.wheelTimeout&&clearTimeout(this.wheelTimeout),this.track.scrollBy({left:a,behavior:"smooth"}),this.wheelTimeout=setTimeout(()=>{this.updateCarouselButtons(),this.updatePagination()},150)}getItemsPerView(){const t=window.innerWidth;return t<=480?1:t<=768?2:3}navigate(t){const e=this.track.querySelectorAll(this.options.slideSelector);if(0===e.length)return;const a=this.getCurrentSlideIndex();let o;o=this.options.infinite?"next"===t?a>=e.length-1?0:a+1:a<=0?e.length-1:a-1:"next"===t?Math.min(e.length-1,a+1):Math.max(0,a-1),this.navigateToSlide(o)}navigateToSlide(t){const e=this.track.querySelectorAll(this.options.slideSelector);if(0===e.length||t<0||t>=e.length)return;const a=e[t],o=a.offsetWidth,r=this.track.offsetWidth;let s=a.offsetLeft-(r-o)/2;s=Math.max(0,Math.min(s,this.track.scrollWidth-r)),"undefined"!=typeof gsap?gsap.to(this.track,{scrollLeft:s,duration:this.options.animationDuration,ease:"power2.inOut",onComplete:()=>{this.updateAriaLabels(),this.focusSlide(t)}}):(this.track.scrollTo({left:s,behavior:"smooth"}),setTimeout(()=>{this.updateAriaLabels(),this.focusSlide(t)},300)),this.currentSlide=t}getCurrentSlideIndex(){const t=this.track.querySelectorAll(this.options.slideSelector),e=this.track.scrollLeft+this.track.offsetWidth/2;let a=0,o=1/0;return t.forEach((t,r)=>{const s=t.offsetLeft+t.offsetWidth/2,i=Math.abs(s-e);i<o&&(o=i,a=r)}),a}startAutoplay(){this.options.autoplay&&!this.autoplayTimer&&(this.autoplayTimer=setInterval(()=>{this.isPaused||this.isDown||this.navigate("next")},this.options.autoplayDelay))}stopAutoplay(){this.autoplayTimer&&(clearInterval(this.autoplayTimer),this.autoplayTimer=null)}pauseAutoplay(){this.isPaused=!0}resumeAutoplay(){this.isPaused=!1}setupSlideFocusManagement(){this.track.querySelectorAll(this.options.slideSelector).forEach((t,e)=>{t.tabIndex=-1,t.addEventListener("focus",()=>{this.currentSlide=e}),t.addEventListener("click",e=>{e.target.closest("button")||t.focus()})}),this.wrapper.tabIndex=-1,this.wrapper.style.outline="none",this.wrapper.addEventListener("click",t=>{t.target.closest("button")||t.target.closest("[tabindex]")||this.track.focus()})}focusSlide(t){const e=this.track.querySelectorAll(this.options.slideSelector);e[t]&&document.activeElement===this.track&&e[t].focus()}initializePagination(){if(!this.paginationContainer)return;this.paginationContainer.innerHTML="";const t=this.track.querySelectorAll(this.options.slideSelector),e=this.getItemsPerView(),a=Math.ceil(t.length/e);for(let t=0;t<a;t++){const e=document.createElement("button");e.className="brag-book-gallery-pagination-dot",e.role="tab",0===t?(e.classList.add("brag-book-gallery-active"),e.setAttribute("aria-selected","true")):e.setAttribute("aria-selected","false"),e.setAttribute("data-page",t),e.setAttribute("aria-label",`Go to slide group ${t+1}`),e.addEventListener("click",()=>this.goToPage(t)),this.paginationContainer.appendChild(e)}}goToPage(t){const e=this.track.querySelectorAll(this.options.slideSelector);if(0===e.length)return;const a=e[0].offsetWidth,o=this.getItemsPerView(),r=t*o*(a+this.options.gap);this.currentSlide=t*o,"undefined"!=typeof gsap?gsap.to(this.track,{scrollLeft:r,duration:.5,ease:"power2.inOut",onComplete:()=>this.updateAriaLabels()}):(this.track.scrollLeft=r,this.updateAriaLabels())}updatePagination(){if(!this.paginationContainer)return;const t=this.track.querySelectorAll(this.options.slideSelector);if(0===t.length)return;const e=t[0].offsetWidth,a=this.getItemsPerView(),o=this.track.scrollLeft,r=Math.round(o/((e+this.options.gap)*a));this.currentSlide=r*a,this.paginationContainer.querySelectorAll(".brag-book-gallery-pagination-dot").forEach((t,e)=>{e===r?(t.classList.add("brag-book-gallery-active"),t.setAttribute("aria-selected","true")):(t.classList.remove("brag-book-gallery-active"),t.setAttribute("aria-selected","false"))})}updateCarouselButtons(){if(this.options.infinite)return this.prevBtn&&(this.prevBtn.disabled=!1),void(this.nextBtn&&(this.nextBtn.disabled=!1));const t=this.track.scrollLeft,e=this.track.scrollWidth,a=this.track.clientWidth;this.prevBtn&&(this.prevBtn.disabled=t<=0),this.nextBtn&&(this.nextBtn.disabled=t>=e-a-1)}updateAriaLabels(){const t=this.track.querySelectorAll(this.options.slideSelector),e=t.length,a=this.getCurrentSlideIndex();t.forEach((t,o)=>{const r=o+1,s=o===a;t.setAttribute("aria-label",`Slide ${r} of ${e}${s?" (current)":""}`),t.setAttribute("aria-current",s?"true":"false")}),this.liveRegion&&(this.liveRegion.textContent=`Slide ${a+1} of ${e}`)}refresh(){this.options.itemsPerView=this.getItemsPerView(),this.initializePagination(),this.updatePagination(),this.updateAriaLabels()}goToSlide(t){const e=this.track.querySelectorAll(this.options.slideSelector),a=Array.from(e).find(e=>e.dataset.slide===t);if(a){const t=Array.from(e).indexOf(a),o=this.getItemsPerView(),r=Math.floor(t/o);this.goToPage(r)}}},e=class{constructor(t,e={}){this.dialog=document.getElementById(t),this.closeButtons=this.dialog?.querySelectorAll('[data-action*="close"]'),this.options={closeOnBackdrop:!1!==e.closeOnBackdrop,closeOnEscape:!1!==e.closeOnEscape,onOpen:e.onOpen||(()=>{}),onClose:e.onClose||(()=>{}),...e},this.dialog&&this.init()}init(){this.setupEventListeners()}setupEventListeners(){this.closeButtons?.forEach(t=>{t.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),this.close()})}),this.options.closeOnBackdrop&&this.dialog&&this.dialog.addEventListener("click",t=>{t.target===this.dialog&&this.close()}),this.options.closeOnEscape&&this.dialog&&this.dialog.addEventListener("cancel",t=>{t.preventDefault(),this.close()})}open(){if(this.dialog)try{this.dialog.showModal(),document.body.style.overflow="hidden",this.options.onOpen()}catch(t){console.error("Error opening dialog:",t),this.dialog.setAttribute("open",""),this.dialog.style.display="block",document.body.style.overflow="hidden",this.options.onOpen()}}close(){if(this.dialog)try{this.dialog.close(),document.body.style.overflow="",this.dialog.style.display="",this.options.onClose()}catch(t){console.error("Error closing dialog:",t),this.dialog.removeAttribute("open"),this.dialog.style.display="none",document.body.style.overflow="",this.options.onClose()}}isOpen(){return this.dialog?.open||this.dialog?.hasAttribute("open")}},a=class{constructor(t,e={}){this.container=t,this.filterHeaders=t?.querySelectorAll(".brag-book-gallery-nav-button"),this.activeFilters=new Map,this.categories=new Map,this.procedures=new Map,this.originalTitle=document.title,this.originalDescription=document.querySelector('meta[name="description"]')?.content||"",this.options={mode:e.mode||"javascript",baseUrl:e.baseUrl||"/gallery",animateWithGsap:"undefined"!=typeof gsap,closeOthersOnOpen:!1!==e.closeOthersOnOpen,onFilterChange:e.onFilterChange||(()=>{}),onNavigate:e.onNavigate||(t=>{window.location.href=t}),...e},this.container&&this.init()}init(){this.indexFilters(),this.setupEventListeners(),this.loadStateFromUrl(),this.options.animateWithGsap&&"undefined"!=typeof gsap&&gsap.set(".brag-book-gallery-nav-list-submenu",{height:0})}indexFilters(){const t=this.container?.querySelectorAll("[data-category]");t?.forEach(t=>{const e=t.dataset.category;this.categories.has(e)||this.categories.set(e,{name:e,procedures:new Set,element:t}),t.querySelectorAll(".brag-book-gallery-nav-link").forEach(t=>{const e=t.dataset.procedure,a=t.dataset.category;if(e&&a){const o={id:e,category:a,count:parseInt(t.dataset.procedureCount||"0"),element:t.parentElement,link:t};this.procedures.set(`${a}:${e}`,o),this.categories.get(a).procedures.add(e)}})})}setupEventListeners(){this.filterHeaders?.forEach(t=>{t.addEventListener("click",()=>this.toggleFilter(t))});const t=this.container?.querySelectorAll(".brag-book-gallery-nav-link");t?.forEach(t=>{t.addEventListener("click",t=>{t.preventDefault(),this.handleFilterClick(t.currentTarget)})}),window.addEventListener("popstate",t=>{t.state&&t.state.caseId?window.loadCaseDetails(t.state.caseId,t.state.procedureId,t.state.procedureSlug):t.state&&t.state.category&&t.state.procedure?(this.reactivateFilter(t.state.category,t.state.procedure),this.loadFilteredContent(t.state.category,t.state.procedure,t.state.procedureIds,t.state.hasNudity||!1)):(this.clearAll(),window.location.reload())})}toggleFilter(t){const e="true"===t.dataset.expanded,a=t.nextElementSibling,o=t.closest(".brag-book-gallery-nav-list__item");!e&&this.options.closeOthersOnOpen&&this.closeOtherFilters(t),t.dataset.expanded=!e,a.dataset.expanded=!e,o.dataset.expanded=!e,this.options.animateWithGsap&&"undefined"!=typeof gsap?e?gsap.to(a,{height:0,opacity:0,duration:.3,ease:"power2.in"}):gsap.to(a,{height:"auto",opacity:1,duration:.4,ease:"power2.out"}):(a.style.height=e?"0":"auto",a.style.opacity=e?"0":"1")}closeOtherFilters(t){this.filterHeaders?.forEach(e=>{if(e!==t&&"true"===e.dataset.expanded){const t=e.nextElementSibling,a=e.closest(".brag-book-gallery-nav-list__item");e.dataset.expanded="false",t.dataset.expanded="false",a.dataset.expanded="false",this.options.animateWithGsap&&"undefined"!=typeof gsap?gsap.to(t,{height:0,opacity:0,duration:.3,ease:"power2.in"}):(t.style.height="0",t.style.opacity="0")}})}closeAllFilters(){this.filterHeaders?.forEach(t=>{"true"===t.dataset.expanded&&this.toggleFilter(t)})}handleFilterClick(t){const e=t.dataset.category,a=t.dataset.procedure,o=t.dataset.procedureIds,r=parseInt(t.dataset.procedureCount||"0"),s="true"===t.dataset.nudity;this.activeFilters.clear(),this.container?.querySelectorAll(".brag-book-gallery-nav-link").forEach(t=>{t.classList.remove("brag-book-gallery-active")}),t.classList.add("brag-book-gallery-active");const i=t.closest(".brag-book-gallery-nav-list-submenu__item");i&&i.classList.add("brag-book-gallery-active"),this.activeFilters.set(`${e}:${a}`,{category:e,procedure:a,procedureIds:o,count:r,hasNudity:s}),this.updateFilterBadges();const n=document.querySelector(".brag-book-gallery-wrapper");let l=n?.dataset.baseUrl||window.location.pathname;!n?.dataset.baseUrl&&l.match(/\/[^\/]+\/?$/)&&(l=l.replace(/\/[^\/]+\/?$/,""));const c=`${l}/${a}/`.replace(/\/+/g,"/");window.history.pushState({category:e,procedure:a,procedureIds:o,basePath:l,hasNudity:s},"",c),this.loadFilteredContent(e,a,o,s),this.options.animateWithGsap&&"undefined"!=typeof gsap&&gsap.to(t,{scale:1.02,duration:.1,yoyo:!0,repeat:1,ease:"power2.inOut"})}navigateToFilteredPage(){if(this.activeFilters.size>0){const t=`/${Array.from(this.activeFilters.values())[0].procedure}`;this.options.onNavigate(t)}else this.options.onNavigate(this.options.baseUrl)}updateUrlState(){if(window.history&&window.history.replaceState){const t=new URLSearchParams,e=new Map;this.activeFilters.forEach(t=>{e.has(t.category)||e.set(t.category,[]),e.get(t.category).push(t.procedure)}),e.forEach((e,a)=>{t.append(a,e.join(","))});const a=t.toString()?`?${t.toString()}`:window.location.pathname;window.history.replaceState({},"",a)}}reactivateFilter(t,e){this.activeFilters.clear(),this.container?.querySelectorAll(".brag-book-gallery-nav-link").forEach(t=>{t.classList.remove("brag-book-gallery-active")});const a=document.querySelector(`.brag-book-gallery-nav-link[data-procedure="${e}"]`);a&&(a.classList.add("brag-book-gallery-active"),this.activeFilters.set(`${t}:${e}`,{category:t,procedure:e,procedureIds:a.dataset.procedureIds,count:parseInt(a.dataset.procedureCount||"0")}),this.updateFilterBadges())}loadStateFromUrl(){const t=document.querySelector(".brag-book-gallery-wrapper"),e=t?.dataset.baseUrl||"",a=t?.dataset.initialProcedure;if(a){const t=document.querySelector(`.brag-book-gallery-nav-link[data-procedure="${a}"]`);if(t){const e=t.dataset.category||"",o="true"===t.dataset.nudity;return this.reactivateFilter(e,a),void this.loadFilteredContent(e,a,t.dataset.procedureIds,o)}}const o=window.location.pathname;let r=o;e&&o.startsWith(e)&&(r=o.substring(e.length));const s=r.match(/^\/([^\/]+)\/(\d+)\/?$/);if(s){const[,t,e]=s;return}const i=r.match(/^\/([^\/]+)\/?$/);if(i){const[,t]=i,e=document.querySelector(`.brag-book-gallery-nav-link[data-procedure="${t}"]`);if(e){const a=e.dataset.category||"",o="true"===e.dataset.nudity;this.reactivateFilter(a,t),this.loadFilteredContent(a,t,e.dataset.procedureIds,o)}}}getActiveFilters(){return this.activeFilters}getFiltersByCategory(t){const e=[];return this.activeFilters.forEach(a=>{a.category===t&&e.push(a)}),e}getFiltersByProcedure(t){const e=[];return this.activeFilters.forEach(a=>{a.procedure===t&&e.push(a)}),e}clearCategory(t){const e=[];this.activeFilters.forEach((a,o)=>{a.category===t&&e.push(o)}),e.forEach(t=>{const e=this.procedures.get(t);e&&e.link&&e.link.classList.remove("brag-book-gallery-active")}),e.forEach(t=>this.activeFilters.delete(t))}clearAll(){const t=this.container?.querySelectorAll(".brag-book-gallery-nav-link");t?.forEach(t=>{t.classList.remove("brag-book-gallery-active")}),this.activeFilters.clear(),window.history.pushState({},"",window.location.pathname)}setMode(t){this.options.mode=t}loadFilteredContent(t,e,a,o=!1){const r=document.getElementById("gallery-content");if(!r)return;r.innerHTML='<div class="brag-book-gallery-loading">Loading filtered results...</div>';const s=window.bragBookGalleryConfig?.ajaxUrl||"/wp-admin/admin-ajax.php",i=window.bragBookGalleryConfig?.nonce||"";let n=e;const l=document.querySelector(`.brag-book-gallery-nav-link[data-procedure="${e}"]`);if(l){const t=l.querySelector(".brag-book-gallery-filter-option-label");t&&(n=t.textContent.trim())}const c=new FormData;c.append("action","brag_book_load_filtered_gallery"),c.append("nonce",i),c.append("procedure_name",n),c.append("procedure_slug",e),c.append("procedure_ids",a||""),c.append("procedure_id",a?.split(",")[0]||""),c.append("has_nudity",o?"1":"0"),fetch(s,{method:"POST",body:c}).then(t=>t.json()).then(t=>{if(t.success&&t.data?.html){if(r.innerHTML=t.data.html,t.data.seo&&(t.data.seo.title&&(document.title=t.data.seo.title),t.data.seo.description)){let e=document.querySelector('meta[name="description"]');e||(e=document.createElement("meta"),e.name="description",document.head.appendChild(e)),e.content=t.data.seo.description}r.querySelectorAll(".brag-book-gallery-carousel-wrapper").forEach(t=>{new Carousel(t)}),setTimeout(function(){initializeProcedureFilters()},100)}else r.innerHTML='<div class="brag-book-gallery-error">No results found for the selected filter.</div>'}).catch(t=>{console.error("Filter loading error:",t),r.innerHTML='<div class="brag-book-gallery-error">Failed to load filtered content. Please try again.</div>'})}updateFilterBadges(){const t=document.querySelector('[data-action="filter-badges"]'),e=document.querySelector('[data-action="clear-filters"]');if(!t||!e)return;t.querySelectorAll("[data-filter-key]").forEach(t=>t.remove());const a=this.activeFilters.size>0;a&&this.activeFilters.forEach((e,a)=>{const o=this.createFilterBadge(e.category,e.procedure,a);t.appendChild(o)});const o=t.querySelectorAll("[data-filter-category]"),r=a||o.length>0;e.style.display=r?"inline-block":"none"}createFilterBadge(t,e,a){const o=document.createElement("div");o.className="brag-book-gallery-filter-badge",o.setAttribute("data-filter-key",a);let r="";switch(t){case"age":r=`Age: ${e}`;break;case"gender":r=`Gender: ${e}`;break;case"ethnicity":r=`Ethnicity: ${e}`;break;case"procedure":r=e;break;default:r=`${t}: ${e}`}return o.innerHTML=`\n\t\t\t<span class="brag-book-gallery-badge-text">${r}</span>\n\t\t\t<button class="brag-book-gallery-badge-remove" aria-label="Remove ${r} filter">\n\t\t\t\t<svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">\n\t\t\t\t\t<path d="M13 1L1 13M1 1l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t`,o.querySelector(".brag-book-gallery-badge-remove").addEventListener("click",t=>{t.preventDefault(),this.removeFilterBadge(a)}),o}removeFilterBadge(t){const e=this.activeFilters.get(t);if(e){this.activeFilters.delete(t);const a=document.querySelector(`[data-category="${e.category}"][data-procedure="${e.procedure}"]`);a&&a.classList.remove("brag-book-gallery-active"),this.updateFilterBadges(),this.options.onFilterChange(this.activeFilters)}}clearAllFilters(){const t=this.container?.querySelectorAll(".brag-book-gallery-nav-list-submenu-link");t?.forEach(t=>{t.classList.remove("brag-book-gallery-active")}),this.activeFilters.clear(),this.updateFilterBadges(),this.options.onFilterChange(this.activeFilters),window.history.pushState({},"",window.location.pathname)}},o=class{constructor(t={}){this.sidebar=document.querySelector(".brag-book-gallery-sidebar"),this.overlay=document.querySelector(".brag-book-gallery-mobile-overlay"),this.menuToggle=document.querySelector(".brag-book-gallery-mobile-menu-toggle"),this.closeButton=document.querySelector('[data-action="close-menu"]'),this.options={breakpoint:t.breakpoint||1024,swipeToClose:!1!==t.swipeToClose,...t},this.touchStartX=0,this.touchEndX=0,this.sidebar&&this.menuToggle&&this.init()}init(){let t;this.setupEventListeners(),this.checkMobileView(),window.addEventListener("resize",()=>{clearTimeout(t),t=setTimeout(()=>{this.checkMobileView()},250)})}setupEventListeners(){this.menuToggle?.addEventListener("click",()=>this.toggle()),this.overlay?.addEventListener("click",()=>this.close()),this.closeButton?.addEventListener("click",()=>this.close()),this.sidebar&&this.sidebar.addEventListener("click",t=>{t.target.closest(".brag-book-gallery-nav-link")&&window.innerWidth<this.options.breakpoint&&setTimeout(()=>{this.close()},100)}),this.options.swipeToClose&&this.setupSwipeGestures(),document.addEventListener("keydown",t=>{"Escape"===t.key&&this.isOpen()&&this.close()})}setupSwipeGestures(){this.sidebar?.addEventListener("touchstart",t=>{this.touchStartX=t.changedTouches[0].screenX},{passive:!0}),this.sidebar?.addEventListener("touchend",t=>{this.touchEndX=t.changedTouches[0].screenX,this.handleSwipeGesture()},{passive:!0})}handleSwipeGesture(){this.touchStartX-this.touchEndX>50&&this.isOpen()&&this.close()}checkMobileView(){const t=window.innerWidth<=this.options.breakpoint,e=document.querySelector(".brag-book-gallery-sidebar-header"),a=document.querySelector(".brag-book-gallery-mobile-header");e&&(e.style.display=t?"flex":"none"),a&&(a.style.display=t?"flex":"none"),t||(this.close(),document.body.classList.remove("brag-book-gallery-mobile-menu-open"))}toggle(){this.isOpen()?this.close():this.open()}open(){if(!this.sidebar||!this.menuToggle)return;this.menuToggle.dataset.menuOpen="true",this.menuToggle.setAttribute("aria-expanded","true"),this.menuToggle.setAttribute("aria-label","Close navigation menu"),this.sidebar.classList.add("brag-book-gallery-active"),this.overlay?.classList.add("brag-book-gallery-active"),document.body.classList.add("brag-book-gallery-mobile-menu-open");const t=document.querySelector(".brag-book-gallery-wrapper");t&&(t.style.zIndex="9999");const e=this.menuToggle.querySelector("svg");e&&(e.innerHTML='<path d="M256-213.85 213.85-256l224-224-224-224L256-746.15l224 224 224-224L746.15-704l-224 224 224 224L704-213.85l-224-224-224 224Z"/>'),document.body.style.overflow="hidden",this.previousFocus=document.activeElement,setTimeout(()=>{const t=this.sidebar.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');t&&t.focus()},300)}close(){if(!this.sidebar||!this.menuToggle)return;this.menuToggle.dataset.menuOpen="false",this.menuToggle.setAttribute("aria-expanded","false"),this.menuToggle.setAttribute("aria-label","Open navigation menu"),this.sidebar.classList.remove("brag-book-gallery-active"),this.overlay?.classList.remove("brag-book-gallery-active"),document.body.classList.remove("brag-book-gallery-mobile-menu-open");const t=document.querySelector(".brag-book-gallery-wrapper");t&&(t.style.zIndex="");const e=this.menuToggle.querySelector("svg");e&&(e.innerHTML='<path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"/>'),document.body.style.overflow="",this.previousFocus&&this.previousFocus.focus&&this.previousFocus.focus()}isOpen(){return"true"===this.menuToggle?.dataset.menuOpen}},r=class{constructor(t={}){this.favorites=new Set,this.userInfo=null,this.hasShownDialog=!1,this.options={storageKey:t.storageKey||"brag-book-favorites",userInfoKey:t.userInfoKey||"brag-book-user-info",persistToStorage:!1!==t.persistToStorage,onUpdate:t.onUpdate||(()=>{}),...t},this.init()}init(){this.favoritesDialog=new e("favoritesDialog",{onClose:()=>{!this.userInfo&&this.lastAddedFavorite&&(this.removeFavorite(this.lastAddedFavorite),this.lastAddedFavorite=null)}}),this.options.persistToStorage&&(this.loadFromStorage(),this.loadUserInfo()),this.setupEventListeners(),this.updateUI()}setupEventListeners(){document.addEventListener("click",t=>{const e=t.target.closest("[data-favorited]");e&&(t.preventDefault(),this.toggleFavorite(e)),t.target.closest('[data-action="close-favorites-dialog"]')&&this.favoritesDialog.close()});const t=document.querySelector('[data-form="favorites"]');t&&t.addEventListener("submit",t=>{t.preventDefault(),this.handleFavoritesFormSubmit(t.target)})}toggleFavorite(t){let e=t.dataset.itemId||t.dataset.caseId||"";const a="true"===t.dataset.favorited;if(e){const t=e.match(/(\d+)/);t&&(e=t[1])}a?this.removeFavorite(e,t):e?(this.userInfo&&this.userInfo.email||this.loadUserInfo(),this.userInfo&&this.userInfo.email?(this.addFavorite(e,t),this.submitFavoriteToAPI(e)):(this.lastAddedFavorite=e,this.lastAddedButton=t,this.addFavorite(e,t),this.favoritesDialog.open(),this.hasShownDialog=!0)):console.error("No item ID found on button:",t)}addFavorite(t,e){e&&(e.dataset.favorited="true"),document.querySelectorAll(`[data-item-id="${t}"], [data-case-id="${t}"]`).forEach(t=>{void 0!==t.dataset.favorited&&(t.dataset.favorited="true")}),this.favorites.add(t),this.options.persistToStorage&&this.saveToStorage(),this.updateUI(),this.options.onUpdate(this.favorites),window.dispatchEvent(new CustomEvent("favoritesUpdated",{detail:{favorites:this.favorites}}))}removeFavorite(t,e){e?(e.dataset.favorited="false",document.querySelectorAll(`[data-item-id="${t}"], [data-case-id="${t}"]`).forEach(t=>{t!==e&&void 0!==t.dataset.favorited&&(t.dataset.favorited="false")})):document.querySelectorAll(`[data-item-id="${t}"][data-favorited="true"], [data-case-id="${t}"][data-favorited="true"]`).forEach(t=>{t.dataset.favorited="false"}),this.favorites.delete(t),this.options.persistToStorage&&this.saveToStorage(),this.updateUI(),this.options.onUpdate(this.favorites),window.dispatchEvent(new CustomEvent("favoritesUpdated",{detail:{favorites:this.favorites}}))}submitFavoriteToAPI(t){const e=new FormData;e.append("action","brag_book_add_favorite"),e.append("nonce",window.bragBookGalleryConfig?.nonce||""),e.append("case_id",t),e.append("email",this.userInfo.email||""),e.append("phone",this.userInfo.phone||""),e.append("name",this.userInfo.name||""),fetch(window.bragBookGalleryConfig?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:e}).then(t=>t.json()).then(t=>{t.success?this.showSuccessNotification("Added to favorites!"):console.error("Failed to save favorite:",t.data?.message)}).catch(t=>{console.error("Error submitting favorite:",t)})}handleFavoritesFormSubmit(t){const e=new FormData(t),a=Object.fromEntries(e.entries());this.lastAddedFavorite&&e.append("case_id",this.lastAddedFavorite),e.append("action","brag_book_add_favorite"),e.append("nonce",window.bragBookGalleryConfig?.nonce||"");const o=t.querySelector('button[type="submit"]'),r=o?o.textContent:"";o&&(o.disabled=!0,o.textContent="Submitting...");const s=t.querySelector(".brag-book-gallery-form-error"),i=t.querySelector(".brag-book-gallery-form-success");s&&s.remove(),i&&i.remove(),fetch(window.bragBookGalleryConfig?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:e}).then(t=>{if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()}).then(e=>{if(e.success){this.userInfo=a,this.options.persistToStorage&&this.saveUserInfo();try{localStorage.setItem(this.options.userInfoKey,JSON.stringify(a))}catch(t){console.error("Failed to save user info to localStorage:",t)}const o=document.createElement("div");o.className="brag-book-gallery-form-success",o.textContent=e.data.message||"Your information has been saved. Keep adding favorites!",t.appendChild(o),setTimeout(()=>{this.favoritesDialog.close(),t.reset(),o&&o.remove()},2e3),this.showSuccessNotification(e.data.message||"Your information has been saved. Keep adding favorites!"),this.lastAddedFavorite=null,this.lastAddedButton=null}else{const a=document.createElement("div");a.className="brag-book-gallery-form-error",a.textContent=e.data.message||"Failed to save. Please try again.",t.appendChild(a),this.lastAddedFavorite&&this.lastAddedButton&&this.removeFavorite(this.lastAddedFavorite,this.lastAddedButton)}}).catch(e=>{console.error("Error submitting favorites form:",e);const a=document.createElement("div");a.className="brag-book-gallery-form-error",a.textContent="An error occurred. Please try again.",t.appendChild(a),this.lastAddedFavorite&&this.lastAddedButton&&this.removeFavorite(this.lastAddedFavorite,this.lastAddedButton)}).finally(()=>{o&&(o.disabled=!1,o.textContent=r)})}showSuccessNotification(t){let e=document.getElementById("favoritesNotification");e||(e=document.createElement("div"),e.id="favoritesNotification",e.className="brag-book-gallery-favorites-notification",document.body.appendChild(e)),e.textContent=t,e.classList.add("active"),"undefined"!=typeof gsap&&gsap.fromTo(e,{y:-20,opacity:0},{y:0,opacity:1,duration:.3,ease:"back.out(1.7)"}),setTimeout(()=>{"undefined"!=typeof gsap?gsap.to(e,{y:-20,opacity:0,duration:.2,ease:"power2.in",onComplete:()=>{e.classList.remove("active")}}):e.classList.remove("active")},3e3)}updateFavoritesDisplay(){const t=document.getElementById("favorites-grid"),e=document.getElementById("favorites-empty");t&&e&&(t.innerHTML="",0===this.favorites.size?(t.style.display="none",e.style.display="block"):(t.style.display="grid",e.style.display="none",this.favorites.forEach(e=>{const a=document.querySelector(`[data-item-id="${e}"]`);if(!a)return;const o=a.closest(".brag-book-gallery-carousel-item");if(!o)return;const r=o.querySelector("img");if(!r)return;const s=document.createElement("div");s.className="brag-book-gallery-favorites-item",s.dataset.itemId=e;const i=r.cloneNode(!0);s.appendChild(i);const n=document.createElement("button");n.className="brag-book-gallery-favorites-item-remove",n.innerHTML="×",n.title="Remove from favorites",n.onclick=t=>{t.stopPropagation(),this.removeFavorite(e)},s.appendChild(n),t.appendChild(s)})))}updateUI(){const t=document.querySelectorAll("[data-favorites-count]"),e=this.favorites.size;t.forEach(t=>{"undefined"!=typeof gsap?gsap.to(t,{opacity:0,duration:.1,onComplete:()=>{t.textContent=`(${e})`,gsap.to(t,{opacity:1,duration:.1})}}):t.textContent=`(${e})`}),this.updateFavoritesDisplay()}loadFromStorage(){try{const t=localStorage.getItem(this.options.storageKey);if(t){const e=JSON.parse(t);this.favorites=new Set(e),e.forEach(t=>{document.querySelectorAll(`[data-item-id="${t}"], [data-case-id="${t}"]`).forEach(t=>{void 0!==t.dataset.favorited&&(t.dataset.favorited="true")})})}}catch(t){console.error("Failed to load favorites from storage:",t)}}saveToStorage(){try{localStorage.setItem(this.options.storageKey,JSON.stringify([...this.favorites]))}catch(t){console.error("Failed to save favorites to storage:",t)}}loadUserInfo(){try{const t=localStorage.getItem(this.options.userInfoKey);t&&(this.userInfo=JSON.parse(t),this.hasShownDialog=!0)}catch(t){console.error("Failed to load user info from storage:",t)}}saveUserInfo(){try{localStorage.setItem(this.options.userInfoKey,JSON.stringify(this.userInfo))}catch(t){console.error("Failed to save user info to storage:",t)}}getFavorites(){return this.favorites}clear(){this.favorites.clear(),this.options.persistToStorage&&this.saveToStorage(),this.updateUI()}},s=class{constructor(t={}){this.options={shareMenuId:t.shareMenuId||"shareMenu",animateWithGsap:"undefined"!=typeof gsap,onShare:t.onShare||(()=>{}),...t},this.shareMenu=document.getElementById(this.options.shareMenuId),this.activeButton=null,this.activeItem=null,this.init()}init(){this.setupEventListeners(),this.createShareMenu()}createShareMenu(){}setupEventListeners(){document.addEventListener("click",t=>{const e=t.target.closest(".brag-book-gallery-share-button");e&&(t.preventDefault(),t.stopPropagation(),this.toggleShareDropdown(e));const a=t.target.closest(".brag-book-gallery-share-dropdown-item");if(a){t.preventDefault();const e=a.dataset.shareType;e&&(this.handleShare(e),this.hideShareDropdown())}document.querySelectorAll(".brag-book-gallery-share-dropdown.active").forEach(e=>{if(!e.contains(t.target)&&!t.target.closest(".brag-book-gallery-share-button")){e.classList.remove("active");const t=e.closest(".brag-book-gallery-share-button");t&&t.classList.remove("active")}})}),document.addEventListener("keydown",t=>{"Escape"===t.key&&document.querySelectorAll(".brag-book-gallery-share-dropdown.active").forEach(t=>{t.classList.remove("active");const e=t.closest(".brag-book-gallery-share-button");e&&e.classList.remove("active")})})}toggleShareDropdown(t){this.activeButton===t&&this.shareMenu?.classList.contains("active")?this.hideShareDropdown():this.showShareDropdown(t)}showShareDropdown(t){this.activeItem=t.closest(".brag-book-gallery-carousel-item"),this.activeButton=t;let e=t.querySelector(".brag-book-gallery-share-dropdown");if(!e){const a='\n                <div class="brag-book-gallery-share-dropdown" role="menu">\n                    <button class="brag-book-gallery-share-dropdown-item" data-share-type="link" role="menuitem">Copy Link</button>\n                    <button class="brag-book-gallery-share-dropdown-item" data-share-type="email" role="menuitem">Email</button>\n                    <button class="brag-book-gallery-share-dropdown-item" data-share-type="facebook" role="menuitem">Facebook</button>\n                    <button class="brag-book-gallery-share-dropdown-item" data-share-type="twitter" role="menuitem">Twitter</button>\n                    <button class="brag-book-gallery-share-dropdown-item" data-share-type="pinterest" role="menuitem">Pinterest</button>\n                    <button class="brag-book-gallery-share-dropdown-item" data-share-type="whatsapp" role="menuitem">WhatsApp</button>\n                </div>\n            ';t.insertAdjacentHTML("beforeend",a),e=t.querySelector(".brag-book-gallery-share-dropdown")}this.shareMenu=e,t.classList.add("active"),this.shareMenu.classList.add("active"),this.options.animateWithGsap&&"undefined"!=typeof gsap&&gsap.fromTo(this.shareMenu,{y:-10,opacity:0},{y:0,opacity:1,duration:.2,ease:"power2.out"})}hideShareDropdown(){this.shareMenu&&(this.activeButton&&this.activeButton.classList.remove("active"),this.options.animateWithGsap&&"undefined"!=typeof gsap?gsap.to(this.shareMenu,{y:-10,opacity:0,duration:.15,ease:"power2.in",onComplete:()=>{this.shareMenu.classList.remove("active"),this.activeButton=null,this.activeItem=null}}):(this.shareMenu.classList.remove("active"),this.activeButton=null,this.activeItem=null))}handleShare(t){if(!this.activeItem)return;const e=this.activeItem.querySelector("img"),a=e?.src||"",o=e?.alt||"Medical procedure result",r=this.activeItem.dataset.slide||"",s=`${window.location.origin+window.location.pathname}#${r}`,i=`Check out this ${o}`;switch(t){case"link":this.copyToClipboard(s);break;case"email":this.shareViaEmail(s,i);break;case"facebook":this.shareViaFacebook(s);break;case"twitter":this.shareViaTwitter(s,i);break;case"pinterest":this.shareViaPinterest(s,a,i);break;case"whatsapp":this.shareViaWhatsApp(s,i)}this.options.onShare({type:t,url:s,text:i})}copyToClipboard(t){navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(t).then(()=>{this.showNotification("Link copied to clipboard!")}).catch(()=>{this.fallbackCopyToClipboard(t)}):this.fallbackCopyToClipboard(t)}fallbackCopyToClipboard(t){const e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.left="-999999px",document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy"),this.showNotification("Link copied to clipboard!")}catch(t){this.showNotification("Failed to copy link")}document.body.removeChild(e)}shareViaEmail(t,e){const a=encodeURIComponent("Check out this medical procedure result"),o=encodeURIComponent(`${e}\n\n${t}`);window.location.href=`mailto:?subject=${a}&body=${o}`}shareViaFacebook(t){const e=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(t)}`;this.openShareWindow(e,"facebook")}shareViaTwitter(t,e){const a=`https://twitter.com/intent/tweet?url=${encodeURIComponent(t)}&text=${encodeURIComponent(e)}`;this.openShareWindow(a,"twitter")}shareViaPinterest(t,e,a){const o=`https://pinterest.com/pin/create/button/?url=${encodeURIComponent(t)}&media=${encodeURIComponent(e)}&description=${encodeURIComponent(a)}`;this.openShareWindow(o,"pinterest")}shareViaWhatsApp(t,e){const a=`https://wa.me/?text=${encodeURIComponent(`${e} ${t}`)}`;this.openShareWindow(a,"whatsapp")}openShareWindow(t,e){const a=(window.innerWidth-600)/2,o=(window.innerHeight-400)/2;window.open(t,`share-${e}`,`width=600,height=400,left=${a},top=${o},toolbar=no,menubar=no,scrollbars=yes,resizable=yes`)}showNotification(t){let e=document.getElementById("shareNotification");e||(e=document.createElement("div"),e.id="shareNotification",e.className="brag-book-gallery-share-notification",document.body.appendChild(e)),e.textContent=t,e.classList.add("active"),this.options.animateWithGsap&&"undefined"!=typeof gsap&&gsap.fromTo(e,{y:-20,opacity:0},{y:0,opacity:1,duration:.3,ease:"back.out(1.7)"}),setTimeout(()=>{this.options.animateWithGsap&&"undefined"!=typeof gsap?gsap.to(e,{y:-20,opacity:0,duration:.2,ease:"power2.in",onComplete:()=>{e.classList.remove("active")}}):e.classList.remove("active")},3e3)}async shareNative(t){if(navigator.share)try{return await navigator.share({title:t.title||"Medical Procedure Result",text:t.text,url:t.url}),!0}catch(t){return"AbortError"!==t.name&&console.error("Share failed:",t),!1}return!1}},i=class{constructor(t,e={}){this.wrapper=t,this.input=t.querySelector(".brag-book-gallery-search-input"),this.dropdown=t.querySelector(".brag-book-gallery-search-dropdown"),this.searchIcon=t.querySelector(".brag-book-gallery-search-icon"),this.options={minChars:e.minChars||1,debounceDelay:e.debounceDelay||200,maxResults:e.maxResults||10,onSelect:e.onSelect||(()=>{}),...e},this.procedures=[],this.filteredResults=[],this.selectedIndex=-1,this.isOpen=!1,this.debounceTimer=null,this.input&&this.dropdown&&this.init()}init(){this.collectProcedures(),this.setupEventListeners()}collectProcedures(){const t=document.querySelectorAll(".brag-book-gallery-nav-link"),e=new Map;t.forEach(t=>{const a=t.dataset.procedure,o=t.dataset.category,r=t.querySelector(".brag-book-gallery-filter-option-label")?.textContent||a,s=parseInt(t.dataset.procedureCount||"0");if(a&&o){const t=`${o}:${a}`;e.has(t)||e.set(t,{id:a,name:r.trim(),category:o,count:s,searchText:r.toLowerCase(),fullName:`${r} (${s})`})}}),this.procedures=Array.from(e.values())}setupEventListeners(){this.input.addEventListener("input",t=>this.handleInput(t)),this.input.addEventListener("focus",()=>this.handleFocus()),this.input.addEventListener("blur",t=>this.handleBlur(t)),this.input.addEventListener("keydown",t=>this.handleKeydown(t)),document.addEventListener("click",t=>{this.wrapper.contains(t.target)||this.close()}),this.dropdown.addEventListener("click",t=>{const e=t.target.closest(".brag-book-gallery-search-item");e&&this.selectItem(e)})}handleInput(t){const e=t.target.value.trim();this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{e.length>=this.options.minChars?this.search(e):this.close()},this.options.debounceDelay)}handleFocus(){const t=this.input.value.trim();t.length>=this.options.minChars&&this.search(t)}handleBlur(t){setTimeout(()=>{this.wrapper.contains(document.activeElement)||this.close()},200)}handleKeydown(t){if(this.isOpen)switch(t.key){case"ArrowDown":t.preventDefault(),this.moveSelection(1);break;case"ArrowUp":t.preventDefault(),this.moveSelection(-1);break;case"Enter":if(t.preventDefault(),this.selectedIndex>=0){const t=this.dropdown.querySelector(`[data-index="${this.selectedIndex}"]`);t&&this.selectItem(t)}break;case"Escape":this.close(),this.input.blur()}else"ArrowDown"===t.key&&this.input.value.trim().length>=this.options.minChars&&(t.preventDefault(),this.search(this.input.value.trim()))}search(t){const e=t.toLowerCase();this.filteredResults=this.procedures.filter(t=>t.searchText.includes(e)||t.category.includes(e)).slice(0,this.options.maxResults),this.filteredResults.sort((t,a)=>{const o=t.searchText===e,r=a.searchText===e;if(o&&!r)return-1;if(!o&&r)return 1;const s=t.searchText.startsWith(e),i=a.searchText.startsWith(e);return s&&!i?-1:!s&&i?1:0}),this.renderResults(t),this.open()}renderResults(t){if(0===this.filteredResults.length)return void(this.dropdown.innerHTML=`\n                <div class="brag-book-gallery-search-no-results">\n                    No procedures found for "${this.escapeHtml(t)}"\n                </div>\n            `);const e=this.filteredResults.map((e,a)=>{const o=this.highlightMatch(e.name,t),r=1===e.count?"case":"cases";return`\n                <div class="brag-book-gallery-search-item"\n                     role="option"\n                     data-index="${a}"\n                     data-procedure="${e.id}"\n                     data-category="${e.category}"\n                     aria-selected="${a===this.selectedIndex}">\n                    <div class="brag-book-gallery-search-item-content">\n                        <span class="brag-book-gallery-search-item-name">${o}</span>\n                        <span class="brag-book-gallery-search-item-count">${e.count} ${r}</span>\n                    </div>\n                    <span class="brag-book-gallery-search-item-category">${e.category}</span>\n                </div>\n            `}).join("");this.dropdown.innerHTML=e,this.selectedIndex=-1}highlightMatch(t,e){const a=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),o=new RegExp(`(${a})`,"gi");return t.replace(o,"<mark>$1</mark>")}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}moveSelection(t){const e=this.dropdown.querySelectorAll(".brag-book-gallery-search-item");0!==e.length&&(this.selectedIndex+=t,this.selectedIndex<0?this.selectedIndex=e.length-1:this.selectedIndex>=e.length&&(this.selectedIndex=0),e.forEach((t,e)=>{const a=e===this.selectedIndex;t.setAttribute("aria-selected",a),a&&t.scrollIntoView({block:"nearest",behavior:"smooth"})}))}selectItem(t){const e=t.dataset.procedure,a=t.dataset.category,o=t.querySelector(".brag-book-gallery-search-item-name"),r=o?o.textContent.replace(/<mark>/g,"").replace(/<\/mark>/g,""):"";this.input.value=r,this.close(),this.options.onSelect({procedure:e,category:a,name:r});const s=document.querySelector(`.brag-book-gallery-nav-link[data-procedure="${e}"]`);s&&s.click()}open(){this.isOpen||(this.isOpen=!0,this.dropdown.classList.add("active"),this.wrapper.classList.add("active"),this.input.setAttribute("aria-expanded","true"))}close(){this.isOpen&&(this.isOpen=!1,this.dropdown.classList.remove("active"),this.wrapper.classList.remove("active"),this.input.setAttribute("aria-expanded","false"),this.selectedIndex=-1)}};class n{constructor(){this.nudityAccepted=!1,this.storageKey="brag-book-nudity-accepted",this.checkInitialAcceptance(),this.init()}checkInitialAcceptance(){try{const t=localStorage.getItem(this.storageKey);this.nudityAccepted="true"===t,this.nudityAccepted&&document.body.classList.add("nudity-accepted")}catch(t){console.warn("Could not load nudity acceptance status from localStorage:",t),this.nudityAccepted=!1}}init(){this.setupEventListeners()}saveAcceptanceStatus(){try{localStorage.setItem(this.storageKey,"true")}catch(t){console.warn("Could not save nudity acceptance status to localStorage:",t)}}setupEventListeners(){document.addEventListener("click",t=>{t.target.matches(".brag-book-gallery-nudity-warning-button")&&this.handleProceedButtonClick(t.target)})}handleProceedButtonClick(t){this.nudityAccepted=!0,this.saveAcceptanceStatus(),document.body.classList.add("nudity-accepted"),this.animateRemoval()}animateRemoval(){const t=document.querySelectorAll(".brag-book-gallery-nudity-warning"),e=document.querySelectorAll(".brag-book-gallery-nudity-blur");t.forEach(t=>{"undefined"!=typeof gsap?gsap.to(t,{opacity:0,duration:.5,ease:"power2.out",onComplete:()=>{t.style.display="none"}}):(t.style.transition="opacity 0.5s ease-out",t.style.opacity="0",setTimeout(()=>{t.style.display="none"},500))}),e.forEach(t=>{"undefined"!=typeof gsap?gsap.to(t,{filter:"blur(0px)",duration:.5,ease:"power2.out"}):(t.style.transition="filter 0.5s ease-out",t.style.filter="blur(0px)")})}resetAcceptance(){this.nudityAccepted=!1;try{localStorage.removeItem(this.storageKey),document.body.classList.remove("nudity-accepted"),console.log("✅ Nudity warning acceptance has been reset. Refresh the page to see warnings again.")}catch(t){console.warn("Could not remove nudity acceptance status from localStorage:",t)}}}class l{constructor(){this.init()}init(){document.querySelectorAll('[data-phone-format="true"]').forEach(t=>{this.setupPhoneInput(t)})}setupPhoneInput(t){t.addEventListener("input",t=>{this.formatPhoneNumber(t.target)}),t.addEventListener("paste",t=>{setTimeout(()=>{this.formatPhoneNumber(t.target)},0)}),t.addEventListener("keypress",t=>{const e=String.fromCharCode(t.which);/[0-9]/.test(e)||8===t.which||46===t.which||t.preventDefault()})}formatPhoneNumber(t){let e=t.value.replace(/\D/g,"");e=e.substring(0,10);let a="";e.length>0&&(a=e.length<=3?`(${e}`:e.length<=6?`(${e.substring(0,3)}) ${e.substring(3)}`:`(${e.substring(0,3)}) ${e.substring(3,6)}-${e.substring(6,10)}`),t.value=a,10===e.length?t.setCustomValidity(""):t.hasAttribute("required")&&e.length>0&&t.setCustomValidity("Please enter a complete 10-digit phone number")}}var c=class{constructor(){this.components={},window.bragBookGalleryApp=this,this.init()}async init(){this.initializeCarousels(),this.initializeDialogs(),this.initializeFilters(),this.initializeMobileMenu(),this.initializeFavorites(),this.initializeSearch(),this.initializeShareManager(),this.initializeConsultationForm(),this.initializeCaseLinks(),this.initializeNudityWarning();const t=document.getElementById("gallery-content");t&&"true"===t.dataset.favoritesPage&&setTimeout(()=>{this.showFavoritesOnly()},100)}initializeCarousels(){const e=document.querySelectorAll(".brag-book-gallery-carousel-wrapper");let a;this.components.carousels=[],e.forEach((e,a)=>{const o=0===a?{infinite:!0,autoplay:!0,autoplayDelay:4e3,pauseOnHover:!0}:{infinite:!1,autoplay:!1};this.components.carousels.push(new t(e,o))}),window.addEventListener("resize",()=>{clearTimeout(a),a=setTimeout(()=>{this.components.carousels.forEach(t=>t.refresh())},250)})}initializeDialogs(){this.components.consultationDialog=new e("consultationDialog",{onOpen:()=>{},onClose:()=>{}}),document.querySelectorAll('[data-action="request-consultation"]').forEach(t=>{t.addEventListener("click",()=>{this.components.consultationDialog.open()})})}initializeFilters(){const t=document.querySelector(".brag-book-gallery-nav"),e=t?.dataset.filterMode||"javascript";this.components.filterSystem=new a(t,{mode:e,baseUrl:"/gallery",onFilterChange:t=>{this.applyFilters(t)},onNavigate:t=>{window.location.href=t}}),this.initializeClearAllButton(),this.initializeDemographicFilterBadges()}initializeMobileMenu(){this.components.mobileMenu=new o}initializeFavorites(){if(this.components.favoritesManager=new r({onUpdate:t=>{this.updateFavoritesCount(t.size)}}),this.components.favoritesManager){const t=this.components.favoritesManager.getFavorites().size;this.updateFavoritesCount(t)}this.initializeFavoritesButton(),window.addEventListener("favoritesUpdated",t=>{const e=window.location.pathname;(e===`/${window.bragBookGalleryConfig?.gallerySlug||"before-after"}/myfavorites/`||e.includes("myfavorites"))&&setTimeout(()=>{this.showFavoritesOnly()},100)})}initializeSearch(){const t=document.querySelectorAll(".brag-book-gallery-search-wrapper");this.components.searchAutocompletes=[],t.forEach(t=>{const e=new i(t,{minChars:1,debounceDelay:200,maxResults:10,onSelect:t=>{}});this.components.searchAutocompletes.push(e)})}initializeShareManager(){"undefined"!=typeof bragBookGalleryConfig&&"yes"===bragBookGalleryConfig.enableSharing&&(this.components.shareManager=new s({onShare:t=>{}}))}initializeConsultationForm(){const t=document.querySelector('[data-form="consultation"]');t&&t.addEventListener("submit",t=>{t.preventDefault(),this.handleFormSubmit(t.target)});const e=document.getElementById("consultationDialog");e&&new MutationObserver(t=>{t.forEach(t=>{"attributes"===t.type&&"open"===t.attributeName&&e.hasAttribute("open")&&this.hideModalMessage()})}).observe(e,{attributes:!0})}initializeCaseLinks(){document.addEventListener("click",t=>{const e=t.target.closest(".brag-book-gallery-case-card-link");if(e){t.preventDefault(),t.stopPropagation();const a=e.dataset.caseId,o=e.dataset.procedureIds;return void(a&&this.loadCaseDetails(a,e.href,!0,o))}const a=t.target.closest(".brag-book-gallery-case-card");if(a&&!t.target.closest("button")&&!t.target.closest("details")){const e=a.querySelector(".brag-book-gallery-case-card-link");if(e&&e.href){t.preventDefault();const o=e.dataset.caseId,r=e.dataset.procedureIds||a.dataset.procedureIds;o&&this.loadCaseDetails(o,e.href,!0,r)}}}),this.initializeCaseDetailThumbnails(),window.addEventListener("popstate",t=>{t.state&&t.state.caseId?this.loadCaseDetails(t.state.caseId,window.location.href,!1):window.location.reload()})}async loadCaseDetails(t,e,a=!0,o=null){const r=document.getElementById("gallery-content");if(r){if(!o){const e=document.querySelector(`.brag-book-gallery-case-card[data-case-id="${t}"]`);e&&e.dataset.procedureIds&&(o=e.dataset.procedureIds)}r.innerHTML='<div class="brag-book-gallery-loading">Loading case details...</div>',a&&window.history&&window.history.pushState&&window.history.pushState({caseId:t},"",e);try{if("undefined"==typeof bragBookGalleryConfig)throw new Error("Configuration not loaded");const a=e?new URL(e).pathname.split("/").filter(t=>t):window.location.pathname.split("/").filter(t=>t),s=a.length>2?a[a.length-2]:"";let i="";const n=document.querySelector(`.brag-book-gallery-nav-link[data-procedure="${s}"]`);if(n){const t=n.querySelector(".brag-book-gallery-filter-option-label");t&&(i=t.textContent.trim())}if(!i&&window.bragBookGalleryConfig&&window.bragBookGalleryConfig.sidebarData){const t=window.bragBookGalleryConfig.sidebarData;for(const e of Object.values(t)){if(e.procedures)for(const t of e.procedures)if(t.slug===s){i=t.name;break}if(i)break}}const l={action:"brag_book_load_case_details_html",case_id:t,procedure_slug:s,procedure_name:i,nonce:bragBookGalleryConfig.nonce||""};o&&(l.procedure_ids=o);const c=await fetch(bragBookGalleryConfig.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(l)});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const d=await c.json();if(!(d.success&&d.data&&d.data.html))throw new Error(d.data?.message||d.data||d.message||"Failed to load case details");{r.innerHTML=d.data.html;const t=document.querySelector(".brag-book-gallery-wrapper");if(t?t.scrollIntoView({behavior:"smooth",block:"start"}):r.scrollIntoView({behavior:"smooth",block:"start"}),d.data.seo&&(d.data.seo.title&&(document.title=d.data.seo.title),d.data.seo.description)){let t=document.querySelector('meta[name="description"]');t||(t=document.createElement("meta"),t.name="description",document.head.appendChild(t)),t.content=d.data.seo.description}d.data.view_tracked?console.log(`✅ Case view tracked successfully for Case ID: ${d.data.case_id}`):!1===d.data.view_tracked&&(console.warn(`⚠️ Case view tracking failed for Case ID: ${d.data.case_id}`),d.data.debug&&(console.group("View Tracking Debug Info:"),console.log("Tracking attempted:",d.data.debug.view_tracking_attempted),console.log("View tracked:",d.data.debug.view_tracked),d.data.debug.tracking_error&&console.error("Tracking error:",d.data.debug.tracking_error),console.groupEnd())),this.initializeCaseDetailThumbnails()}}catch(t){let e="Failed to load case details. Please try again.";t.message&&(e+="<br><small>"+t.message+"</small>"),r.innerHTML='<div class="brag-book-gallery-error">'+e+"</div>"}}}displayCaseDetails(t){const e=document.getElementById("gallery-content");if(!e)return;let a='<div class="brag-book-gallery-case-card-details">';a+='<button class="brag-book-gallery-back-button" onclick="history.back()">← Back to Gallery</button>',a+='<div class="brag-book-gallery-case-header">',a+=`<h2>${t.procedureName||"Case Details"}</h2>`,a+='<div class="case-metadata">',t.caseNumber&&(a+=`<span class="case-number">Case #${t.caseNumber}</span>`),t.technique&&(a+=`<span class="case-technique">Technique: ${t.technique}</span>`),t.age&&(a+=`<span class="case-age">Age: ${t.age}</span>`),t.gender&&(a+=`<span class="case-gender">Gender: ${t.gender}</span>`),a+="</div>",a+="</div>",t.photos&&t.photos.length>0?(a+='<div class="brag-book-gallery-case-images">',t.photos.forEach((t,e)=>{(t.beforeImage||t.afterImage)&&(a+='<div class="brag-book-gallery-case-image-pair">',t.isProcessed&&t.beforeImage?(a+='<div class="processed-image">',a+=`<img src="${t.beforeImage}" alt="Before and After" />`,t.caption&&(a+=`<p class="image-caption">${t.caption}</p>`),a+="</div>"):(t.beforeImage&&(a+='<div class="before-image">',a+="<h3>Before</h3>",a+=`<img src="${t.beforeImage}" alt="Before" loading="lazy" />`,a+="</div>"),t.afterImage&&(a+='<div class="after-image">',a+="<h3>After</h3>",a+=`<img src="${t.afterImage}" alt="After" loading="lazy" />`,a+="</div>"),t.caption&&(a+=`<p class="image-caption">${t.caption}</p>`)),a+="</div>")}),a+="</div>"):a+='<div class="brag-book-gallery-no-images">No images available for this case.</div>',t.description&&(a+='<div class="brag-book-gallery-case-description">',a+="<h3>Details</h3>",t.description.includes("<")?a+=t.description:a+=`<p>${t.description}</p>`,a+="</div>"),a+="</div>",e.innerHTML=a,e.scrollIntoView({behavior:"smooth",block:"start"})}handleSearch(t){t.toLowerCase().trim()}applyFilters(t){}async handleFormSubmit(t){const e=new FormData(t),a=Object.fromEntries(e.entries()),o=t.querySelector('[data-action="form-submit"]'),r=o?o.textContent:"";o&&(o.disabled=!0,o.textContent="Sending...");try{if("undefined"==typeof bragBookGalleryConfig)throw new Error("Configuration not loaded. Please refresh the page.");const e=new URLSearchParams({action:"handle_form_submission",nonce:bragBookGalleryConfig.consultation_nonce||bragBookGalleryConfig.nonce,name:a.name||"",email:a.email||"",phone:a.phone||"",description:a.message||""}),o=await fetch(bragBookGalleryConfig.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e,credentials:"same-origin"}),r=await o.json();if(r.success)this.showModalMessage("Thank you for your consultation request! We will contact you soon.","success"),setTimeout(()=>{t.reset(),this.hideModalMessage(),this.components&&this.components.consultationDialog&&setTimeout(()=>{this.components.consultationDialog.close()},1e3)},3e3);else{const t=r.data||"Failed to send consultation request. Please try again.";this.showModalMessage(t,"error")}}catch(t){this.showModalMessage(t.message||"An error occurred. Please try again.","error")}finally{o&&(o.disabled=!1,o.textContent=r)}}showModalMessage(t,e="info"){const a=document.getElementById("consultationMessage"),o=a?.querySelector(".brag-book-gallery-form-message-content");if(!a||!o)return void this.showNotification(t,e);o.textContent=t,a.className="brag-book-gallery-form-message",a.classList.add(`brag-book-gallery-form-message-${e}`),a.style.display="block";const r=a.closest(".brag-book-gallery-dialog-content");r&&(r.scrollTop=0)}hideModalMessage(){const t=document.getElementById("consultationMessage");if(t){t.style.display="none";const e=t.querySelector(".brag-book-gallery-form-message-content");e&&(e.textContent="")}}initializeCaseDetailThumbnails(){document.addEventListener("click",t=>{const e=t.target.closest(".brag-book-gallery-thumbnail-item");if(!e)return;const a=document.querySelector(".brag-book-gallery-main-image-container");if(!a)return;const o=document.querySelectorAll(".brag-book-gallery-thumbnail-item");if(!o.length)return;o.forEach(t=>t.classList.remove("active")),e.classList.add("active");const r=e.dataset.processedUrl,s=e.dataset.imageIndex;a.dataset.imageIndex=s;let i="";if(r){const t=a.querySelector(".brag-book-gallery-favorite-button"),e=t?t.dataset.itemId.replace("_main",""):"";i=`\n\t\t\t\t\t<div class="brag-book-gallery-main-single">\n\t\t\t\t\t\t<img src="${r}" alt="Case Image" loading="eager">\n\t\t\t\t\t\t<div class="brag-book-gallery-item-actions">\n\t\t\t\t\t\t\t<button class="brag-book-gallery-favorite-button" data-favorited="false" data-item-id="${e}_main" aria-label="Add to favorites">\n\t\t\t\t\t\t\t\t<svg fill="rgba(255, 255, 255, 0.5)" stroke="white" stroke-width="2" viewBox="0 0 24 24">\n\t\t\t\t\t\t\t\t\t<path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t`,"undefined"!=typeof bragBookGalleryConfig&&"yes"===bragBookGalleryConfig.enableSharing&&(i+=`\n\t\t\t\t\t\t\t<button class="brag-book-gallery-share-button" data-item-id="${e}_main" aria-label="Share this image">\n\t\t\t\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">\n\t\t\t\t\t\t\t\t\t<path d="M672.22-100q-44.91 0-76.26-31.41-31.34-31.41-31.34-76.28 0-6 4.15-29.16L284.31-404.31q-14.46 15-34.36 23.5t-42.64 8.5q-44.71 0-76.01-31.54Q100-435.39 100-480q0-44.61 31.3-76.15 31.3-31.54 76.01-31.54 22.74 0 42.64 8.5 19.9 8.5 34.36 23.5l284.46-167.08q-2.38-7.38-3.27-14.46-.88-7.08-.88-15.08 0-44.87 31.43-76.28Q627.49-860 672.4-860t76.25 31.44Q780-797.13 780-752.22q0 44.91-31.41 76.26-31.41 31.34-76.28 31.34-22.85 0-42.5-8.69Q610.15-662 595.69-677L311.23-509.54q2.38 7.39 3.27 14.46.88 7.08.88 15.08t-.88 15.08q-.89 7.07-3.27 14.46L595.69-283q14.46-15 34.12-23.69 19.65-8.69 42.5-8.69 44.87 0 76.28 31.43Q780-252.51 780-207.6t-31.44 76.25Q717.13-100 672.22-100Zm.09-60q20.27 0 33.98-13.71Q720-187.42 720-207.69q0-20.27-13.71-33.98-13.71-13.72-33.98-13.72-20.27 0-33.98 13.72-13.72 13.71-13.72 33.98 0 20.27 13.72 33.98Q652.04-160 672.31-160Zm-465-272.31q20.43 0 34.25-13.71 13.83-13.71 13.83-33.98 0-20.27-13.83-33.98-13.82-13.71-34.25-13.71-20.11 0-33.71 13.71Q160-500.27 160-480q0 20.27 13.6 33.98 13.6 13.71 33.71 13.71Zm465-272.3q20.27 0 33.98-13.72Q720-732.04 720-752.31q0-20.27-13.71-33.98Q692.58-800 672.31-800q-20.27 0-33.98 13.71-13.72 13.71-13.72 33.98 0 20.27 13.72 33.98 13.71 13.72 33.98 13.72Zm0 496.92ZM207.69-480Zm464.62-272.31Z"/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t`),i+="\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"}a.innerHTML=i,window.bragBookGalleryApp&&window.bragBookGalleryApp.components&&(window.bragBookGalleryApp.components.favoritesManager&&window.bragBookGalleryApp.components.favoritesManager.initializeFavoriteButtons(),window.bragBookGalleryApp.components.shareManager&&window.bragBookGalleryApp.components.shareManager.initializeShareButtons())})}showNotification(t,e="info"){let a=document.querySelector(".brag-book-notification");a||(a=document.createElement("div"),a.className="brag-book-notification",a.style.cssText="\n\t\t\t\tposition: fixed;\n\t\t\t\ttop: 20px;\n\t\t\t\tright: 20px;\n\t\t\t\tpadding: 15px 20px;\n\t\t\t\tborder-radius: 4px;\n\t\t\t\tz-index: 10000;\n\t\t\t\ttransition: opacity 0.3s ease;\n\t\t\t\tmax-width: 350px;\n\t\t\t",document.body.appendChild(a));const o={success:"#4caf50",error:"#f44336",info:"#2196f3"};a.style.backgroundColor=o[e]||o.info,a.style.color="white",a.textContent=t,a.style.opacity="1",setTimeout(()=>{a.style.opacity="0",setTimeout(()=>{a.parentNode&&a.parentNode.removeChild(a)},300)},5e3)}initializeClearAllButton(){const t=()=>{const t=document.querySelector('[data-action="clear-filters"]');return!!t&&(t.removeEventListener("click",this.handleClearAll),t.addEventListener("click",this.handleClearAll.bind(this)),!0)};t()||setTimeout(()=>{t()},1e3),document.addEventListener("click",t=>{t.target&&"clear-filters"===t.target.dataset.action&&(t.preventDefault(),this.handleClearAll(t))})}handleClearAll(t){t.preventDefault(),this.clearDemographicFilters()}initializeDemographicFilterBadges(){window.updateDemographicFilterBadges=t=>{this.updateDemographicBadges(t)},window.applyProcedureFilters,this.monitorDemographicFilters(),document.addEventListener("click",t=>{const e=t.target.closest(".brag-book-gallery-badge-remove");if(e){t.preventDefault(),t.stopPropagation();const a=e.closest(".brag-book-gallery-filter-badge");if(a){const t=a.getAttribute("data-filter-category"),e=a.getAttribute("data-filter-value");t&&e&&this.removeDemographicFilter(t,e)}}})}monitorDemographicFilters(){const t=console.log;console.log=(...e)=>{t.apply(console,e),e.length>=2&&"Active filters:"===e[0]&&"object"==typeof e[1]&&this.updateDemographicBadges(e[1])},document.addEventListener("change",t=>{"checkbox"===t.target.type&&t.target.closest(".brag-book-gallery-filter-group")&&setTimeout(()=>{const t=this.buildActiveFiltersFromDOM();this.updateDemographicBadges(t)},100)});let e="";setInterval(()=>{const t=this.buildActiveFiltersFromDOM(),a=JSON.stringify(t);a!==e&&(this.updateDemographicBadges(t),e=a)},1e3)}buildActiveFiltersFromDOM(){const t={age:[],gender:[],ethnicity:[],height:[],weight:[]};return document.querySelectorAll('.brag-book-gallery-filter-group input[type="checkbox"]:checked').forEach(e=>{const a=e.closest(".brag-book-gallery-filter-group"),o=a?.querySelector("summary"),r=o?.textContent?.toLowerCase()||"",s=e.nextElementSibling,i=s?.textContent?.trim()||e.value||"";r.includes("age")||i.includes("-")?t.age.push(i):r.includes("gender")||["male","female"].some(t=>i.toLowerCase().includes(t))?t.gender.push(i):r.includes("ethnicity")?t.ethnicity.push(i):r.includes("height")||i.includes("ft")||i.includes("'")?t.height.push(i):(r.includes("weight")||i.includes("lbs")||i.includes("kg"))&&t.weight.push(i)}),t}updateDemographicBadges(t){const e=document.querySelector('[data-action="filter-badges"]'),a=document.querySelector('[data-action="clear-filters"]');if(!e||!a)return;e.innerHTML="";let o=!1;t&&Object.keys(t).forEach(a=>{const r=t[a];r&&r.length>0&&(o=!0,r.forEach(t=>{const o=this.createDemographicBadge(a,t);e.appendChild(o)}))});const r=e.querySelectorAll("[data-filter-key]"),s=o||r.length>0;a.style.display=s?"inline-block":"none"}createDemographicBadge(t,e){const a=document.createElement("div");a.className="brag-book-gallery-filter-badge",a.setAttribute("data-filter-category",t),a.setAttribute("data-filter-value",e);let o="",r=e;switch(t){case"age":o=`Age: ${e}`;break;case"gender":o=`Gender: ${e}`,r=e.replace(/^(Male|Female)$/i,t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase());break;case"ethnicity":o=`Ethnicity: ${e}`;break;case"height":o=`Height: ${e}`;break;case"weight":o=`Weight: ${e}`;break;default:o=`${t}: ${e}`}return a.innerHTML=`\n\t\t\t<span class="brag-book-gallery-badge-text">${o}</span>\n\t\t\t<button class="brag-book-gallery-badge-remove" aria-label="Remove ${o} filter">\n\t\t\t\t<svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">\n\t\t\t\t\t<path d="M13 1L1 13M1 1l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t`,a.querySelector(".brag-book-gallery-badge-remove").addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),this.removeDemographicFilter(t,e)}),a}createProcedureBadge(t,e,a){const o=document.createElement("div");o.className="brag-book-gallery-filter-badge",o.setAttribute("data-filter-key",a);let r=e;return o.innerHTML=`\n\t\t\t<span class="brag-book-gallery-badge-text">${r}</span>\n\t\t\t<button class="brag-book-gallery-badge-remove" aria-label="Remove ${r} filter">\n\t\t\t\t<svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">\n\t\t\t\t\t<path d="M13 1L1 13M1 1l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t`,o.querySelector(".brag-book-gallery-badge-remove").addEventListener("click",t=>{t.preventDefault(),this.components.filterSystem&&this.components.filterSystem.removeFilterBadge(a)}),o}removeDemographicFilter(t,e){let a=null;const o=`input[type="checkbox"][data-filter-type="${t}"][value="${e}"]`;if(a=document.querySelector(o),a||document.querySelectorAll(`input[type="checkbox"][data-filter-type="${t}"]`).forEach(t=>{const o=t.value,r=t.nextElementSibling,s=r?.textContent?.trim()||"";o!==e&&o.toLowerCase()!==e.toLowerCase()&&s!==e&&s.toLowerCase()!==e.toLowerCase()||(a=t)}),!a){const o=`procedure-filter-${t}-${e}`.toLowerCase().replace(/\s+/g,"-");a=document.getElementById(o)}if(a){a.checked=!1;const o=new Event("change",{bubbles:!0});a.dispatchEvent(o);const r=new Event("input",{bubbles:!0});a.dispatchEvent(r),setTimeout(()=>{const t=this.buildActiveFiltersFromDOM();this.updateDemographicBadges(t),"function"==typeof window.applyDemographicFilters&&window.applyDemographicFilters()},100);const s=document.querySelector(`.brag-book-gallery-filter-badge[data-filter-category="${t}"][data-filter-value="${e}"]`);s&&s.remove()}else console.warn(`Could not find checkbox for ${t}: ${e}`),document.querySelectorAll('input[type="checkbox"][data-filter-type]').forEach(t=>{console.log(`  - Type: ${t.getAttribute("data-filter-type")}, Value: ${t.value}, ID: ${t.id}`)})}clearDemographicFilters(){['.brag-book-gallery-filter-group input[type="checkbox"]:checked','input[type="checkbox"][data-filter-category]:checked','.brag-book-gallery-filter-option input[type="checkbox"]:checked'].forEach(t=>{document.querySelectorAll(t).forEach(t=>{t.checked=!1,t.dispatchEvent(new Event("change",{bubbles:!0}))})}),window.clearProcedureFilters&&window.clearProcedureFilters(),setTimeout(()=>{this.updateDemographicBadges({age:[],gender:[],ethnicity:[],height:[],weight:[]})},100)}reloadGalleryContent(){const t=document.querySelector(".brag-book-gallery-filtered-results");if(t){const e=new FormData;e.append("action","brag_book_load_filtered_gallery"),e.append("nonce",window.bragBookGalleryAjax?.nonce||""),e.append("procedure_ids",""),e.append("has_nudity",document.body.classList.contains("nudity-accepted")?"1":"0"),fetch(window.bragBookGalleryAjax?.ajax_url||"/wp-admin/admin-ajax.php",{method:"POST",body:e}).then(t=>t.json()).then(e=>{e.success?t.innerHTML=e.data.html:console.error("Failed to reload gallery:",e.data?.message)}).catch(t=>{console.error("Error reloading gallery:",t)})}}updateFavoritesCount(t){document.querySelectorAll("[data-favorites-count]").forEach(e=>{e.textContent=`(${t})`})}initializeFavoritesButton(){const t=document.querySelectorAll('[data-action="show-favorites"]');t.length&&t.forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),t.classList.contains("brag-book-gallery-favorites-link")?this.showFavoritesView():this.toggleFavoritesView()})})}showFavoritesView(){if(document.querySelectorAll('[data-action="show-favorites"]').forEach(t=>t.classList.add("active")),window.history&&window.history.pushState){const t=`/${window.bragBookGalleryConfig?.gallerySlug||"before-after"}/myfavorites/`;window.history.pushState({view:"favorites"},"",t)}this.showFavoritesOnly()}toggleFavoritesView(){const t=document.querySelector('[data-action="show-favorites"]:not(.brag-book-gallery-favorites-link)'),e=t?.classList.contains("active");e?(this.showAllCases(),document.querySelectorAll('[data-action="show-favorites"]').forEach(t=>{t.classList.remove("active")})):(this.showFavoritesOnly(),document.querySelectorAll('[data-action="show-favorites"]').forEach(t=>{t.classList.add("active")}))}showFavoritesOnly(){const t=document.getElementById("gallery-content");if(!t)return;const e=t.querySelector("#gallery-sections");e&&(e.style.display="none");const a="brag-book-user-info";let o=null;try{const t=localStorage.getItem(a);t&&(o=JSON.parse(t))}catch(t){console.error("Failed to load user info:",t)}if(!o||!o.email){t.innerHTML='\n\t\t\t\t<div class="brag-book-gallery-favorites-wrapper">\n\t\t\t\t\t<div class="brag-book-gallery-favorites-container">\n\t\t\t\t\t\t<div class="brag-book-gallery-favorites-form-wrapper">\n\t\t\t\t\t\t\t<svg class="brag-book-gallery-favorites-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 180">\n\t\t\t\t\t\t\t\t<path fill="#ff595c" d="M85.5,124.6l40-84.7h16.2v104.9h-12.8V60.7l-39.8,84.1h-7.2L42.2,59.7v85.1h-12.8V39.9h16.8l39.3,84.7Z"></path>\n\t\t\t\t\t\t\t\t<path fill="#ff595c" d="M186.2,131.1l25-62.4h12.9l-32.6,80.1c-2.6,6.3-5.2,11.4-7.9,15.3-2.7,3.8-5.7,6.6-9.1,8.3-3.3,1.7-7.4,2.6-12.2,2.6s-3.4,0-4.9-.4c-1.5-.2-2.9-.6-4.2-.9v-10.6c1.3.2,2.7.4,4.2.6,1.4.2,2.9.3,4.5.3,3.9,0,7.2-1.3,9.8-3.9,2.6-2.6,5.3-7.2,8.1-13.9l-32.4-77.3h13.4l25.4,62.4v-.2Z"></path>\n\t\t\t\t\t\t\t\t<path fill="#121827" d="M303.1,39.9v11.2h-60.4v35.6h55.2v11.2h-55.2v46.9h-12.8V39.9h73.2,0Z"></path>\n\t\t\t\t\t\t\t\t<path fill="#121827" d="M344.1,67.2c11.6,0,20.2,2.9,25.9,8.7,5.7,5.8,8.5,14.9,8.5,27.4v41.5h-7.9l-2.4-23.7c-2.7,7.8-7.2,13.9-13.7,18.4-6.4,4.5-14,6.8-22.8,6.8s-9.2-.9-12.8-2.8c-3.6-1.9-6.5-4.4-8.5-7.5s-3-6.5-3-10,1.3-8.7,3.9-12.5,6.7-7.1,12.4-9.9c5.7-2.8,13-4.7,22.1-5.8l20-2.5c-.8-6.2-2.9-10.7-6.4-13.4s-8.6-4-15.2-4-12.3,1.4-15.7,4.3c-3.3,2.9-5.6,6.8-6.8,11.8h-12.6c1.1-7.8,4.5-14.2,10.2-19.3,5.8-5.1,14-7.6,24.9-7.6h-.1ZM335,135.5c5.8,0,11.1-1.4,15.8-4.2,4.7-2.8,8.4-6.5,11.2-11.2,2.8-4.7,4.2-9.9,4.2-15.7l-15.4,1.9c-7.9,1-14,2.3-18.5,4.2-4.5,1.8-7.7,3.9-9.6,6.3-1.9,2.3-2.8,4.8-2.9,7.4,0,3.2,1.1,5.9,3.7,8.1s6.4,3.3,11.6,3.3h-.1Z"></path>\n\t\t\t\t\t\t\t\t<path fill="#121827" d="M419.7,127l25-58.4h13.1l-33.4,76.2h-9.8l-33.2-76.2h13.2l25,58.4h.1Z"></path>\n\t\t\t\t\t\t\t\t<path fill="#121827" d="M495.7,146.3c-7.9,0-14.7-1.6-20.4-4.7-5.8-3.1-10.2-7.5-13.3-13.3s-4.7-12.5-4.7-20.3v-2.6c0-7.8,1.6-14.6,4.7-20.3,3.1-5.7,7.6-10.1,13.3-13.2,5.8-3.1,12.6-4.7,20.4-4.7s14.6,1.6,20.4,4.7c5.8,3.1,10.2,7.5,13.3,13.2s4.7,12.5,4.7,20.3v2.6c0,7.8-1.6,14.5-4.7,20.3-3.1,5.8-7.5,10.2-13.3,13.3s-12.6,4.7-20.4,4.7ZM495.7,135.5c8.3,0,14.8-2.4,19.3-7.1,4.5-4.8,6.8-12,6.8-21.6s-2.3-16.9-6.8-21.6c-4.5-4.8-10.9-7.1-19.3-7.1s-14.8,2.4-19.3,7.1c-4.5,4.7-6.8,11.9-6.8,21.6s2.3,16.9,6.8,21.6,10.9,7.1,19.3,7.1Z"></path>\n\t\t\t\t\t\t\t\t<path fill="#121827" d="M579.5,67.2c2.2,0,4,0,5.5.4,1.5.2,2.7.5,3.7.8v12.1c-1.4-.2-2.9-.3-4.5-.4-1.6,0-3.4,0-5.5,0-7.2,0-12.8,2.6-16.8,7.8s-6,13.9-6,26.1v31h-12.2v-76.2h7.9l2.3,22.1c2.1-8.3,5.4-14.4,10-18,4.6-3.7,9.8-5.5,15.6-5.5h0Z"></path>\n\t\t\t\t\t\t\t\t<path fill="#121827" d="M607.6,144.8h-12.2v-76.2h12.2v76.2Z"></path>\n\t\t\t\t\t\t\t\t<path fill="#121827" d="M670,68.7v10.8h-27.2v40.5c0,5.5,1.1,9.4,3.4,11.9,2.3,2.4,5.8,3.7,10.5,3.7s5.1,0,7.2-.4c2.1-.3,4.2-.6,6.2-1v10.6c-1.6.4-3.5.7-5.5,1-2.1.3-4.7.4-7.8.4-17.4,0-26.2-8.4-26.2-25.3v-41.5h-15.7v-10.8h16l4-22.6h7.9v22.6h27.2,0Z"></path>\n\t\t\t\t\t\t\t\t<path fill="#121827" d="M749.7,102.9c0,2.8-.2,5.3-.6,7.5h-62.2c.7,8.5,3.2,14.9,7.6,19,4.4,4.1,10.5,6.2,18.3,6.2s8.8-.7,11.9-2.1c3-1.4,5.4-3.3,7.1-5.5,1.7-2.3,3.1-4.8,4-7.5h12.5c-.9,4.5-2.7,8.7-5.5,12.7s-6.6,7.2-11.6,9.6c-4.9,2.4-11.2,3.6-18.8,3.6s-14.5-1.6-20.2-4.7c-5.7-3.1-10.1-7.5-13.2-13.3-3.1-5.8-4.7-12.5-4.7-20.3v-2.6c0-7.8,1.6-14.6,4.7-20.3,3.1-5.7,7.6-10.1,13.4-13.2,5.8-3.1,12.6-4.7,20.5-4.7s14.1,1.5,19.5,4.5c5.5,3,9.7,7.1,12.7,12.4,3,5.3,4.5,11.6,4.5,18.8h0ZM712.9,78c-7.6,0-13.6,1.9-18,5.6-4.4,3.7-7,9.4-7.9,17h50.3c-.6-7.5-3-13.1-7.1-16.9-4.2-3.8-9.9-5.7-17.3-5.7h0Z"></path>\n\t\t\t\t\t\t\t\t<path fill="#121827" d="M753.3,119.4h12.5c1.1,5,3.4,8.9,7,11.8,3.7,2.9,9.8,4.3,18.4,4.3s10.1-.5,13.4-1.6c3.3-1.1,5.7-2.5,7.1-4.3,1.4-1.7,2.2-3.5,2.2-5.3s-.6-4.2-1.7-5.8c-1.2-1.6-3.5-2.9-7-4s-8.9-2-16-2.8c-9-1.1-16-2.5-20.9-4.5-4.9-1.9-8.3-4.3-10.1-7.2s-2.8-6.2-2.8-9.9,1.2-7.8,3.7-11.2c2.4-3.4,6.1-6.2,11.1-8.4,4.9-2.2,11.2-3.3,18.8-3.3s14.3,1.2,19.3,3.5,8.9,5.5,11.6,9.6c2.7,4,4.3,8.6,4.8,13.8h-12.5c-.9-5.1-3-9-6.3-11.9s-9-4.3-16.8-4.3-13.4,1.2-16.5,3.5c-3.2,2.3-4.7,5-4.7,7.8s.6,3.9,1.8,5.5c1.2,1.5,3.6,2.9,7.3,4,3.7,1.2,9.2,2.2,16.7,3,8.8,1,15.6,2.4,20.3,4.5,4.8,2,8,4.5,9.9,7.3,1.8,2.9,2.7,6.1,2.7,9.8s-1.3,7.7-3.8,11.2-6.3,6.4-11.5,8.5c-5.2,2.2-11.8,3.2-19.8,3.2s-15.5-1.1-20.9-3.4c-5.4-2.3-9.4-5.5-12.1-9.5-2.7-4-4.4-8.7-5-13.9h-.2Z"></path>\n\t\t\t\t\t\t\t\t<path fill="#121827" d="M849.8,22.7v2.4h-6.1v20.1h-2.9v-20.1h-6.1v-2.4h15.2-.1Z"></path>\n\t\t\t\t\t\t\t\t<path fill="#121827" d="M876.2,22.8v22.3h-2.9v-16.6l-7.4,16.6h-2.1l-7.4-16.7v16.7h-2.9v-22.3h3.2l8.3,18.4,8.3-18.4h3.1-.2Z"></path>\n\t\t\t\t\t\t\t\t<path fill="#ff595c" d="M614.2,19c-2.4-.6-4.8-.3-6.9.9-2.2,1.2-4.1,3.1-5.6,5.2-.2.3-.4.6-.5.9-2.3-3.9-6.6-7.6-11.3-7.2-4.4.4-8.2,3.6-9.1,7.9-1.1,5,2.1,9.6,5.1,13.3,2.8,3.3,5.9,6.3,9,9.3,1.9,1.8,3.9,3.6,5.9,5.3h0c0,0,.2.1.3.1s.2,0,.3-.1c1.7-1.4,3.3-2.9,4.9-4.3,3.2-2.9,6.3-5.9,9.1-9.1,3.1-3.5,6.6-7.9,6.3-12.9-.3-4.3-3.4-8.1-7.6-9.2h0Z"></path>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t<p>Please enter your email to view your saved favorites:</p>\n\t\t\t\t\t\t\t<form class="brag-book-gallery-favorites-lookup-form" id="favorites-email-form">\n\t\t\t\t\t\t\t\t<div class="brag-book-gallery-form-group">\n\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\ttype="email"\n\t\t\t\t\t\t\t\t\t\tname="email"\n\t\t\t\t\t\t\t\t\t\tclass="brag-book-gallery-form-input"\n\t\t\t\t\t\t\t\t\t\tplaceholder="Enter your email address"\n\t\t\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<button type="submit" class="brag-book-gallery-button brag-book-gallery-button--full" data-action="form-submit">\n\t\t\t\t\t\t\t\t\t\tView Favorites\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t';const e=document.getElementById("favorites-email-form");return void(e&&e.addEventListener("submit",t=>{t.preventDefault();const o={email:new FormData(e).get("email")};localStorage.setItem(a,JSON.stringify(o)),this.showFavoritesOnly()}))}t.innerHTML='\n\t\t\t<div class="brag-book-gallery-loading">\n\t\t\t\t<div class="brag-book-gallery-spinner"></div>\n\t\t\t\t<p>Loading your favorites...</p>\n\t\t\t</div>\n\t\t';const r=window.bragBookGalleryConfig?.ajaxUrl||"/wp-admin/admin-ajax.php",s=window.bragBookGalleryConfig?.nonce||"";fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"brag_book_get_favorites_list",email:o.email,nonce:s})}).then(t=>t.json()).then(e=>{if(e.success&&e.data){if(e.data.user_info||e.data.name&&e.data.phone){const t=e.data.user_info||{email:o.email,name:e.data.name||"",phone:e.data.phone||""};if(t.name||t.phone){const e={email:o.email,name:t.name||o.name||"",phone:t.phone||o.phone||""};localStorage.setItem(a,JSON.stringify(e)),o=e}}if(e.data.cases&&Array.isArray(e.data.cases)){let t=[];const a=localStorage.getItem("brag-book-favorites");if(a)try{t=JSON.parse(a)}catch(e){console.error("Error parsing existing favorites:",e),t=[]}const o=new Set(t);e.data.cases.forEach(t=>{const e=t.id||t.caseId||"";e&&o.add(String(e))});const r=Array.from(o);localStorage.setItem("brag-book-favorites",JSON.stringify(r)),this.favoritesManager&&(this.favoritesManager.favorites=new Set(r),this.favoritesManager.updateUI()),document.querySelectorAll("[data-favorites-count]").forEach(t=>{t.textContent=`(${r.length})`,t.style&&(t.style.opacity="1")})}else localStorage.getItem("brag-book-favorites")||localStorage.setItem("brag-book-favorites",JSON.stringify([])),document.querySelectorAll("[data-favorites-count]").forEach(t=>{t.textContent="(0)",t.style&&(t.style.opacity="1")}),this.favoritesManager&&(this.favoritesManager.favorites=new Set,this.favoritesManager.updateUI());if(e.data.html){t.innerHTML=`\n\t\t\t\t\t\t<div class="brag-book-gallery-favorites-wrapper">\n\t\t\t\t\t\t\t<div class="brag-book-gallery-favorites-container">\n\t\t\t\t\t\t\t\t<div class="brag-book-gallery-favorites-view">\n\t\t\t\t\t\t\t\t\t${e.data.html}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`;const a=t.querySelector(".brag-book-gallery-favorites-user");a&&(a.textContent=`Showing favorites for: ${o.email}`),this.reinitializeGalleryComponents(),setTimeout(()=>{const t=localStorage.getItem("brag-book-favorites");if(t)try{JSON.parse(t).forEach(t=>{[`[data-item-id="${t}"]`,`[data-case-id="${t}"]`,`[data-item-id="case-${t}"]`,`[data-item-id="${t}_main"]`].forEach(t=>{document.querySelectorAll(t).forEach(t=>{void 0!==t.dataset.favorited&&(t.dataset.favorited="true")})})})}catch(t){console.error("Error updating favorite button states:",t)}},100)}else"string"==typeof e.data?t.innerHTML=e.data:(localStorage.getItem("brag-book-favorites")||localStorage.setItem("brag-book-favorites",JSON.stringify([])),t.innerHTML=`\n\t\t\t\t\t\t<div class="brag-book-gallery-favorites-wrapper">\n\t\t\t\t\t\t\t<div class="brag-book-gallery-favorites-container">\n\t\t\t\t\t\t\t\t<div class="brag-book-filtered-results">\n\t\t\t\t\t\t\t\t\t<svg class="brag-book-gallery-favorites-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 180">\n\t\t\t\t\t\t\t\t\t\t<path fill="#ff595c" d="M85.5,124.6l40-84.7h16.2v104.9h-12.8V60.7l-39.8,84.1h-7.2L42.2,59.7v85.1h-12.8V39.9h16.8l39.3,84.7Z"></path>\n\t\t\t\t\t\t\t\t\t\t<path fill="#ff595c" d="M186.2,131.1l25-62.4h12.9l-32.6,80.1c-2.6,6.3-5.2,11.4-7.9,15.3-2.7,3.8-5.7,6.6-9.1,8.3-3.3,1.7-7.4,2.6-12.2,2.6s-3.4,0-4.9-.4c-1.5-.2-2.9-.6-4.2-.9v-10.6c1.3.2,2.7.4,4.2.6,1.4.2,2.9.3,4.5.3,3.9,0,7.2-1.3,9.8-3.9,2.6-2.6,5.3-7.2,8.1-13.9l-32.4-77.3h13.4l25.4,62.4v-.2Z"></path>\n\t\t\t\t\t\t\t\t\t\t<path fill="#121827" d="M303.1,39.9v11.2h-60.4v35.6h55.2v11.2h-55.2v46.9h-12.8V39.9h73.2,0Z"></path>\n\t\t\t\t\t\t\t\t\t\t<path fill="#121827" d="M344.1,67.2c11.6,0,20.2,2.9,25.9,8.7,5.7,5.8,8.5,14.9,8.5,27.4v41.5h-7.9l-2.4-23.7c-2.7,7.8-7.2,13.9-13.7,18.4-6.4,4.5-14,6.8-22.8,6.8s-9.2-.9-12.8-2.8c-3.6-1.9-6.5-4.4-8.5-7.5s-3-6.5-3-10,1.3-8.7,3.9-12.5,6.7-7.1,12.4-9.9c5.7-2.8,13-4.7,22.1-5.8l20-2.5c-.8-6.2-2.9-10.7-6.4-13.4s-8.6-4-15.2-4-12.3,1.4-15.7,4.3c-3.3,2.9-5.6,6.8-6.8,11.8h-12.6c1.1-7.8,4.5-14.2,10.2-19.3,5.8-5.1,14-7.6,24.9-7.6h-.1ZM335,135.5c5.8,0,11.1-1.4,15.8-4.2,4.7-2.8,8.4-6.5,11.2-11.2,2.8-4.7,4.2-9.9,4.2-15.7l-15.4,1.9c-7.9,1-14,2.3-18.5,4.2-4.5,1.8-7.7,3.9-9.6,6.3-1.9,2.3-2.8,4.8-2.9,7.4,0,3.2,1.1,5.9,3.7,8.1s6.4,3.3,11.6,3.3h-.1Z"></path>\n\t\t\t\t\t\t\t\t\t\t<path fill="#121827" d="M419.7,127l25-58.4h13.1l-33.4,76.2h-9.8l-33.2-76.2h13.2l25,58.4h.1Z"></path>\n\t\t\t\t\t\t\t\t\t\t<path fill="#121827" d="M495.7,146.3c-7.9,0-14.7-1.6-20.4-4.7-5.8-3.1-10.2-7.5-13.3-13.3s-4.7-12.5-4.7-20.3v-2.6c0-7.8,1.6-14.6,4.7-20.3,3.1-5.7,7.6-10.1,13.3-13.2,5.8-3.1,12.6-4.7,20.4-4.7s14.6,1.6,20.4,4.7c5.8,3.1,10.2,7.5,13.3,13.2s4.7,12.5,4.7,20.3v2.6c0,7.8-1.6,14.5-4.7,20.3-3.1,5.8-7.5,10.2-13.3,13.3s-12.6,4.7-20.4,4.7ZM495.7,135.5c8.3,0,14.8-2.4,19.3-7.1,4.5-4.8,6.8-12,6.8-21.6s-2.3-16.9-6.8-21.6c-4.5-4.8-10.9-7.1-19.3-7.1s-14.8,2.4-19.3,7.1c-4.5,4.7-6.8,11.9-6.8,21.6s2.3,16.9,6.8,21.6,10.9,7.1,19.3,7.1Z"></path>\n\t\t\t\t\t\t\t\t\t\t<path fill="#121827" d="M579.5,67.2c2.2,0,4,0,5.5.4,1.5.2,2.7.5,3.7.8v12.1c-1.4-.2-2.9-.3-4.5-.4-1.6,0-3.4,0-5.5,0-7.2,0-12.8,2.6-16.8,7.8s-6,13.9-6,26.1v31h-12.2v-76.2h7.9l2.3,22.1c2.1-8.3,5.4-14.4,10-18,4.6-3.7,9.8-5.5,15.6-5.5h0Z"></path>\n\t\t\t\t\t\t\t\t\t\t<path fill="#121827" d="M607.6,144.8h-12.2v-76.2h12.2v76.2Z"></path>\n\t\t\t\t\t\t\t\t\t\t<path fill="#121827" d="M670,68.7v10.8h-27.2v40.5c0,5.5,1.1,9.4,3.4,11.9,2.3,2.4,5.8,3.7,10.5,3.7s5.1,0,7.2-.4c2.1-.3,4.2-.6,6.2-1v10.6c-1.6.4-3.5.7-5.5,1-2.1.3-4.7.4-7.8.4-17.4,0-26.2-8.4-26.2-25.3v-41.5h-15.7v-10.8h16l4-22.6h7.9v22.6h27.2,0Z"></path>\n\t\t\t\t\t\t\t\t\t\t<path fill="#121827" d="M749.7,102.9c0,2.8-.2,5.3-.6,7.5h-62.2c.7,8.5,3.2,14.9,7.6,19,4.4,4.1,10.5,6.2,18.3,6.2s8.8-.7,11.9-2.1c3-1.4,5.4-3.3,7.1-5.5,1.7-2.3,3.1-4.8,4-7.5h12.5c-.9,4.5-2.7,8.7-5.5,12.7s-6.6,7.2-11.6,9.6c-4.9,2.4-11.2,3.6-18.8,3.6s-14.5-1.6-20.2-4.7c-5.7-3.1-10.1-7.5-13.2-13.3-3.1-5.8-4.7-12.5-4.7-20.3v-2.6c0-7.8,1.6-14.6,4.7-20.3,3.1-5.7,7.6-10.1,13.4-13.2,5.8-3.1,12.6-4.7,20.5-4.7s14.1,1.5,19.5,4.5c5.5,3,9.7,7.1,12.7,12.4,3,5.3,4.5,11.6,4.5,18.8h0ZM712.9,78c-7.6,0-13.6,1.9-18,5.6-4.4,3.7-7,9.4-7.9,17h50.3c-.6-7.5-3-13.1-7.1-16.9-4.2-3.8-9.9-5.7-17.3-5.7h0Z"></path>\n\t\t\t\t\t\t\t\t\t\t<path fill="#121827" d="M753.3,119.4h12.5c1.1,5,3.4,8.9,7,11.8,3.7,2.9,9.8,4.3,18.4,4.3s10.1-.5,13.4-1.6c3.3-1.1,5.7-2.5,7.1-4.3,1.4-1.7,2.2-3.5,2.2-5.3s-.6-4.2-1.7-5.8c-1.2-1.6-3.5-2.9-7-4s-8.9-2-16-2.8c-9-1.1-16-2.5-20.9-4.5-4.9-1.9-8.3-4.3-10.1-7.2s-2.8-6.2-2.8-9.9,1.2-7.8,3.7-11.2c2.4-3.4,6.1-6.2,11.1-8.4,4.9-2.2,11.2-3.3,18.8-3.3s14.3,1.2,19.3,3.5,8.9,5.5,11.6,9.6c2.7,4,4.3,8.6,4.8,13.8h-12.5c-.9-5.1-3-9-6.3-11.9s-9-4.3-16.8-4.3-13.4,1.2-16.5,3.5c-3.2,2.3-4.7,5-4.7,7.8s.6,3.9,1.8,5.5c1.2,1.5,3.6,2.9,7.3,4,3.7,1.2,9.2,2.2,16.7,3,8.8,1,15.6,2.4,20.3,4.5,4.8,2,8,4.5,9.9,7.3,1.8,2.9,2.7,6.1,2.7,9.8s-1.3,7.7-3.8,11.2-6.3,6.4-11.5,8.5c-5.2,2.2-11.8,3.2-19.8,3.2s-15.5-1.1-20.9-3.4c-5.4-2.3-9.4-5.5-12.1-9.5-2.7-4-4.4-8.7-5-13.9h-.2Z"></path>\n\t\t\t\t\t\t\t\t\t\t<path fill="#121827" d="M849.8,22.7v2.4h-6.1v20.1h-2.9v-20.1h-6.1v-2.4h15.2-.1Z"></path>\n\t\t\t\t\t\t\t\t\t\t<path fill="#121827" d="M876.2,22.8v22.3h-2.9v-16.6l-7.4,16.6h-2.1l-7.4-16.7v16.7h-2.9v-22.3h3.2l8.3,18.4,8.3-18.4h3.1-.2Z"></path>\n\t\t\t\t\t\t\t\t\t\t<path fill="#ff595c" d="M614.2,19c-2.4-.6-4.8-.3-6.9.9-2.2,1.2-4.1,3.1-5.6,5.2-.2.3-.4.6-.5.9-2.3-3.9-6.6-7.6-11.3-7.2-4.4.4-8.2,3.6-9.1,7.9-1.1,5,2.1,9.6,5.1,13.3,2.8,3.3,5.9,6.3,9,9.3,1.9,1.8,3.9,3.6,5.9,5.3h0c0,0,.2.1.3.1s.2,0,.3-.1c1.7-1.4,3.3-2.9,4.9-4.3,3.2-2.9,6.3-5.9,9.1-9.1,3.1-3.5,6.6-7.9,6.3-12.9-.3-4.3-3.4-8.1-7.6-9.2h0Z"></path>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t<p class="brag-book-gallery-favorites-user">Showing favorites for: ${o.email}</p>\n\t\t\t\t\t\t\t\t\t<div class="brag-book-gallery-favorites-empty">\n\t\t\t\t\t\t\t\t\t\t<svg class="empty-icon" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n\t\t\t\t\t\t\t\t\t\t\t<path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t<h3>No favorites yet</h3>\n\t\t\t\t\t\t\t\t\t\t<p>Start browsing the gallery and click the heart icon on cases you love to save them here.</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`)}else localStorage.getItem("brag-book-favorites")||localStorage.setItem("brag-book-favorites",JSON.stringify([])),t.innerHTML=`\n\t\t\t\t\t<div class="brag-book-gallery-favorites-empty">\n\t\t\t\t\t\t<svg class="empty-icon" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n\t\t\t\t\t\t\t<path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t<h2>No favorites found</h2>\n\t\t\t\t\t\t<p>${e.data?.message||"Unable to load favorites. Please try again."}</p>\n\t\t\t\t\t</div>\n\t\t\t\t`}).catch(e=>{console.error("Error loading favorites:",e),t.innerHTML='\n\t\t\t\t<div class="brag-book-gallery-favorites-empty">\n\t\t\t\t\t<svg class="empty-icon" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n\t\t\t\t\t\t<path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<h2>Error loading favorites</h2>\n\t\t\t\t\t<p>An error occurred while loading your favorites. Please try again.</p>\n\t\t\t\t</div>\n\t\t\t'}),this.components.filterSystem&&this.components.filterSystem.clearAllFilters()}showAllCases(){const t=document.getElementById("gallery-content"),e=t?.querySelector("#gallery-sections");e&&(e.style.display="");const a=t?.querySelector(".brag-book-gallery-favorites-header");a&&a.remove(),this.components.filterSystem&&(this.components.filterSystem.clearAllFilters(),this.components.filterSystem.loadInitialCases())}showFavoritesEmptyState(){const t=document.getElementById("gallery-content");if(!t)return;const e=t.querySelector("#gallery-sections");e&&(e.style.display="none");const a=t.querySelector(".brag-book-gallery-cases-grid");if(a){a.innerHTML="";const t=document.createElement("div");t.className="brag-book-gallery-favorites-empty-state",t.innerHTML='\n\t\t\t\t<svg class="empty-icon" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n\t\t\t\t\t<path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>\n\t\t\t\t</svg>\n\t\t\t\t<h2>No favorites yet</h2>\n\t\t\t\t<p>Start browsing the gallery and click the heart icon on cases you love to save them here.</p>\n\t\t\t\t<button class="brag-book-gallery-button" onclick="document.querySelector(\'[data-action=\\\'show-favorites\\\']\').click()">\n\t\t\t\t\tBrowse Gallery\n\t\t\t\t</button>\n\t\t\t',a.parentElement.insertBefore(t,a)}}createCaseCard(t){const e=t.id,a=window.bragBookGalleryConfig?.gallerySlug||"before-after";let o="case",r="Case";const s=window.location.pathname,i=new RegExp(`/${a}/([^/]+)`),n=s.match(i);n&&n[1]?(o=n[1],r=o.split("-").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")):t.technique&&(o=t.technique.toLowerCase().replace(/\s+/g,"-"),r=t.technique);const l="/"+a+"/"+o+"/"+e+"/";let c="";t.photoSets&&t.photoSets.length>0&&(c=t.photoSets[0].postProcessedImageLocation||"");const d=this.components.favoritesManager.getFavorites().has(`case-${e}`);return`\n\t\t\t<article class="brag-book-gallery-case-card" data-case-id="${e}">\n\t\t\t\t<div class="brag-book-gallery-image-container brag-book-gallery-single-image">\n\t\t\t\t\t<div class="brag-book-gallery-skeleton-loader" style="display:none;"></div>\n\t\t\t\t\t<div class="brag-book-gallery-item-actions">\n\t\t\t\t\t\t<button class="brag-book-gallery-favorite-button" data-favorited="${d}" data-item-id="case-${e}" aria-label="${d?"Remove from":"Add to"} favorites">\n\t\t\t\t\t\t\t<svg fill="${d?"red":"rgba(255, 255, 255, 0.5)"}" stroke="white" stroke-width="2" viewBox="0 0 24 24">\n\t\t\t\t\t\t\t\t<path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<a href="${l}" class="brag-book-gallery-case-card-link" data-case-id="${e}">\n\t\t\t\t\t\t<picture class="brag-book-gallery-picture">\n\t\t\t\t\t\t\t<img src="${c}" alt="Case ${e}" loading="lazy" data-image-type="single">\n\t\t\t\t\t\t</picture>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t<div class="brag-book-gallery-case-card-summary">\n\t\t\t\t\t<div class="brag-book-gallery-case-card-summary-info">\n\t\t\t\t\t\t<span class="brag-book-gallery-case-card-summary-info__name">${r}</span>\n\t\t\t\t\t\t<span class="brag-book-gallery-case-card-summary-info__case-number">Fun Case #${e}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="brag-book-gallery-case-card-summary-details">\n\t\t\t\t\t\t${t.age?`<span class="brag-book-gallery-age">${t.age} yrs</span>`:""}\n\t\t\t\t\t\t${t.gender?`<span class="brag-book-gallery-gender">${t.gender}</span>`:""}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</article>\n\t\t`}reinitializeGalleryComponents(){this.initializeCaseLinks(),this.components.favoritesManager&&document.querySelectorAll("[data-favorited]").forEach(t=>{const e=t.dataset.itemId,a=this.components.favoritesManager.getFavorites().has(e);t.dataset.favorited=a.toString()})}initializeNudityWarning(){this.components.nudityWarningManager=new n}};let d,h;window.updateGridLayout=function(t){const e=document.querySelector(".brag-book-gallery-case-grid");e&&window.innerWidth>=1024&&(e.classList.add("grid-initialized"),e.setAttribute("data-columns",t),document.querySelectorAll(".brag-book-gallery-grid-btn").forEach(e=>{parseInt(e.dataset.columns)===t?e.classList.add("active"):e.classList.remove("active")}),localStorage.setItem("bragbook-grid-columns",t))},window.bragBookProcedureFilters={age:[],gender:[],ethnicity:[],height:[],weight:[]},window.initializeProcedureFilters=function(){const t=document.getElementById("procedure-filters-details");t&&!t.dataset.initialized&&(generateProcedureFilterOptions(),t.dataset.initialized="true")},window.generateProcedureFilterOptions=function(){const t=document.getElementById("brag-book-gallery-filters");if(!t)return void console.warn("Filter container not found");let e;if(!window.bragBookCompleteDataset&&window.bragBookGalleryConfig&&window.bragBookGalleryConfig.completeDataset?window.bragBookCompleteDataset=window.bragBookGalleryConfig.completeDataset:window.bragBookCompleteDataset||console.warn("Complete dataset not available from config"),window.bragBookCompleteDataset&&window.bragBookCompleteDataset.length>0){const e={age:new Set,gender:new Set,ethnicity:new Set,height:new Set,weight:new Set},a=[],o=[],r=[];return window.bragBookCompleteDataset.forEach(t=>{const s=t.age||t.patientAge,i=t.gender||t.patientGender,n=t.ethnicity||t.patientEthnicity,l=t.height||t.patientHeight,c=t.weight||t.patientWeight;s&&a.push(parseInt(s)),i&&e.gender.add(i),n&&e.ethnicity.add(n),l&&o.push(parseInt(l)),c&&r.push(parseInt(c))}),a.some(t=>t>=18&&t<25)&&e.age.add("18-24"),a.some(t=>t>=25&&t<35)&&e.age.add("25-34"),a.some(t=>t>=35&&t<45)&&e.age.add("35-44"),a.some(t=>t>=45&&t<55)&&e.age.add("45-54"),a.some(t=>t>=55&&t<65)&&e.age.add("55-64"),a.some(t=>t>=65)&&e.age.add("65+"),o.some(t=>t<60)&&e.height.add("Under 5'0\""),o.some(t=>t>=60&&t<64)&&e.height.add("5'0\" - 5'3\""),o.some(t=>t>=64&&t<68)&&e.height.add("5'4\" - 5'7\""),o.some(t=>t>=68&&t<72)&&e.height.add("5'8\" - 5'11\""),o.some(t=>t>=72)&&e.height.add("6'0\" and above"),r.some(t=>t<120)&&e.weight.add("Under 120 lbs"),r.some(t=>t>=120&&t<150)&&e.weight.add("120-149 lbs"),r.some(t=>t>=150&&t<180)&&e.weight.add("150-179 lbs"),r.some(t=>t>=180&&t<210)&&e.weight.add("180-209 lbs"),r.some(t=>t>=210)&&e.weight.add("210+ lbs"),void generateFilterHTML(t,e)}e=document.querySelectorAll('.brag-book-gallery-case-card[data-card="true"]');const a={age:new Set,gender:new Set,ethnicity:new Set,height:new Set,weight:new Set},o=[],r=[],s=[];e.forEach(t=>{const e=t.dataset.age;e&&o.push(parseInt(e)),t.dataset.gender&&a.gender.add(t.dataset.gender),t.dataset.ethnicity&&a.ethnicity.add(t.dataset.ethnicity);const i=t.dataset.height;if(i){const e=parseInt(i);"cm"===(t.dataset.heightUnit||"in")?r.push(Math.round(e/2.54)):r.push(e)}const n=t.dataset.weight;if(n){const e=parseInt(n);"kg"===(t.dataset.weightUnit||"lbs")?s.push(Math.round(2.205*e)):s.push(e)}}),o.some(t=>t>=18&&t<25)&&a.age.add("18-24"),o.some(t=>t>=25&&t<35)&&a.age.add("25-34"),o.some(t=>t>=35&&t<45)&&a.age.add("35-44"),o.some(t=>t>=45&&t<55)&&a.age.add("45-54"),o.some(t=>t>=55&&t<65)&&a.age.add("55-64"),o.some(t=>t>=65)&&a.age.add("65+"),r.some(t=>t<60)&&a.height.add("Under 5'0\""),r.some(t=>t>=60&&t<64)&&a.height.add("5'0\" - 5'3\""),r.some(t=>t>=64&&t<68)&&a.height.add("5'4\" - 5'7\""),r.some(t=>t>=68&&t<72)&&a.height.add("5'8\" - 5'11\""),r.some(t=>t>=72)&&a.height.add("6'0\" and above"),s.some(t=>t<120)&&a.weight.add("Under 120 lbs"),s.some(t=>t>=120&&t<150)&&a.weight.add("120-149 lbs"),s.some(t=>t>=150&&t<180)&&a.weight.add("150-179 lbs"),s.some(t=>t>=180&&t<210)&&a.weight.add("180-209 lbs"),s.some(t=>t>=210)&&a.weight.add("210+ lbs"),generateFilterHTML(t,a)},window.generateFilterHTML=function(t,e){let a="";e.age.size>0&&(a+='<details class="brag-book-gallery-filter">',a+='<summary class="brag-book-gallery-filter-label">',a+='<span class="brag-book-gallery-filter-label__name">Age</span>',a+='<svg class="brag-book-gallery-filter-label__arrow" width="16" height="16" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">',a+='<path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>',a+="</svg>",a+="</summary>",a+='<ul class="brag-book-gallery-filter-options">',Array.from(e.age).sort().forEach(t=>{const e=`procedure-filter-age-${t.replace(/\s+/g,"-")}`;a+=`<li class="brag-book-gallery-filter-option">\n\t\t\t\t<input type="checkbox" id="${e}" value="${t}" data-filter-type="age">\n\t\t\t\t<label for="${e}">${t}</label>\n\t\t\t</li>`}),a+="</ul>",a+="</details>"),e.gender.size>0&&(a+='<details class="brag-book-gallery-filter">',a+='<summary class="brag-book-gallery-filter-label">',a+='<span class="brag-book-gallery-filter-label__name">Gender</span>',a+='<svg class="brag-book-gallery-filter-label__arrow" width="16" height="16" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">',a+='<path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>',a+="</svg>",a+="</summary>",a+='<ul class="brag-book-gallery-filter-options">',Array.from(e.gender).sort().forEach(t=>{const e=`procedure-filter-gender-${t}`,o=t.charAt(0).toUpperCase()+t.slice(1);a+=`<li class="brag-book-gallery-filter-option">\n\t\t\t\t<input type="checkbox" id="${e}" value="${t}" data-filter-type="gender">\n\t\t\t\t<label for="${e}">${o}</label>\n\t\t\t</li>`}),a+="</ul>",a+="</details>"),e.ethnicity.size>0&&(a+='<details class="brag-book-gallery-filter">',a+='<summary class="brag-book-gallery-filter-label">',a+='<span class="brag-book-gallery-filter-label__name">Ethnicity</span>',a+='<svg class="brag-book-gallery-filter-label__arrow" width="16" height="16" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">',a+='<path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>',a+="</svg>",a+="</summary>",a+='<ul class="brag-book-gallery-filter-options">',Array.from(e.ethnicity).sort().forEach(t=>{const e=`procedure-filter-ethnicity-${t.replace(/\s+/g,"-")}`,o=t.charAt(0).toUpperCase()+t.slice(1);a+=`<li class="brag-book-gallery-filter-option">\n\t\t\t\t<input type="checkbox" id="${e}" value="${t}" data-filter-type="ethnicity">\n\t\t\t\t<label for="${e}">${o}</label>\n\t\t\t</li>`}),a+="</ul>",a+="</details>"),e.height.size>0&&(a+='<details class="brag-book-gallery-filter">',a+='<summary class="brag-book-gallery-filter-label">',a+='<span class="brag-book-gallery-filter-label__name">Height</span>',a+='<svg class="brag-book-gallery-filter-label__arrow" width="16" height="16" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">',a+='<path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>',a+="</svg>",a+="</summary>",a+='<ul class="brag-book-gallery-filter-options">',Array.from(e.height).sort().forEach(t=>{const e=`procedure-filter-height-${t.replace(/\s+/g,"-")}`;a+=`<li class="brag-book-gallery-filter-option">\n\t\t\t\t<input type="checkbox" id="${e}" value="${t}" data-filter-type="height">\n\t\t\t\t<label for="${e}">${t}</label>\n\t\t\t</li>`}),a+="</ul>",a+="</details>"),e.weight.size>0&&(a+='<details class="brag-book-gallery-filter">',a+='<summary class="brag-book-gallery-filter-label">',a+='<span class="brag-book-gallery-filter-label__name">Weight</span>',a+='<svg class="brag-book-gallery-filter-label__arrow" width="16" height="16" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">',a+='<path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>',a+="</svg>",a+="</summary>",a+='<ul class="brag-book-gallery-filter-options">',Array.from(e.weight).sort().forEach(t=>{const e=`procedure-filter-weight-${t.replace(/\s+/g,"-")}`;a+=`<li class="brag-book-gallery-filter-option">\n\t\t\t\t<input type="checkbox" id="${e}" value="${t}" data-filter-type="weight">\n\t\t\t\t<label for="${e}">${t}</label>\n\t\t\t</li>`}),a+="</ul>",a+="</details>"),t.innerHTML=a||"<p>No filters available</p>",t.querySelectorAll('input[type="checkbox"]').forEach(t=>{t.addEventListener("change",function(){applyProcedureFilters()})});const o=document.getElementById("procedure-filters-details");if(o){const t=a&&"<p>No filters available</p>"!==a;o.style.display=t?"":"none"}},window.applyProcedureFilters=function(){const t=document.querySelectorAll(".brag-book-gallery-filter-option input:checked");if(window.bragBookProcedureFilters={age:[],gender:[],ethnicity:[],height:[],weight:[]},t.forEach(t=>{const e=t.dataset.filterType,a=t.value;window.bragBookProcedureFilters[e]&&window.bragBookProcedureFilters[e].push(a)}),!Object.values(window.bragBookProcedureFilters).some(t=>t.length>0)){const t=document.querySelectorAll('.brag-book-gallery-case-card[data-card="true"]');t.forEach(t=>{t.style.display=""}),updateFilteredCount(t.length,t.length);const e=document.querySelector('button[onclick*="loadMoreCases"]')||document.querySelector(".brag-book-gallery-load-more button"),a=e?e.closest(".brag-book-gallery-load-more-container")||e.parentElement:null;return void(a&&e.hasAttribute("data-start-page")&&(a.style.display=""))}if(window.bragBookCompleteDataset&&window.bragBookCompleteDataset.length>0){const t=[];window.bragBookCompleteDataset.forEach(e=>{let a=!0;const o=e.age||e.patientAge,r=e.gender||e.patientGender,s=e.ethnicity||e.patientEthnicity,i=e.height||e.patientHeight,n=e.weight||e.patientWeight;if(window.bragBookProcedureFilters.age.length>0){const t=parseInt(o);let e=!1;window.bragBookProcedureFilters.age.forEach(a=>{("18-24"===a&&t>=18&&t<=24||"25-34"===a&&t>=25&&t<=34||"35-44"===a&&t>=35&&t<=44||"45-54"===a&&t>=45&&t<=54||"55-64"===a&&t>=55&&t<=64||"65+"===a&&t>=65)&&(e=!0)}),e||(a=!1)}if(a&&window.bragBookProcedureFilters.gender.length>0&&(window.bragBookProcedureFilters.gender.includes(r)||(a=!1)),a&&window.bragBookProcedureFilters.ethnicity.length>0&&(window.bragBookProcedureFilters.ethnicity.includes(s)||(a=!1)),a&&window.bragBookProcedureFilters.height.length>0){const t=parseInt(i);let e=!1;window.bragBookProcedureFilters.height.forEach(a=>{("Under 5'0\""===a&&t<60||"5'0\" - 5'3\""===a&&t>=60&&t<64||"5'4\" - 5'7\""===a&&t>=64&&t<68||"5'8\" - 5'11\""===a&&t>=68&&t<72||"6'0\" and above"===a&&t>=72)&&(e=!0)}),e||(a=!1)}if(a&&window.bragBookProcedureFilters.weight.length>0){const t=parseInt(n);let e=!1;window.bragBookProcedureFilters.weight.forEach(a=>{("Under 120 lbs"===a&&t<120||"120-149 lbs"===a&&t>=120&&t<150||"150-179 lbs"===a&&t>=150&&t<180||"180-209 lbs"===a&&t>=180&&t<210||"210+ lbs"===a&&t>=210)&&(e=!0)}),e||(a=!1)}a&&t.push(e.id)}),loadFilteredCases(t)}else{let e=document.querySelectorAll('.brag-book-gallery-case-card[data-card="true"]');0===e.length&&(e=document.querySelectorAll('.brag-book-gallery-case-card[data-card="true"]')),0===e.length&&(e=document.querySelectorAll(".brag-book-gallery-case-card, .brag-book-gallery-case-card"));let a=0;e.forEach((t,e)=>{let o=!0;if(window.bragBookProcedureFilters.age.length>0){const e=parseInt(t.dataset.age);let a=!1;window.bragBookProcedureFilters.age.forEach(t=>{("18-24"===t&&e>=18&&e<25||"25-34"===t&&e>=25&&e<35||"35-44"===t&&e>=35&&e<45||"45-54"===t&&e>=45&&e<55||"55-64"===t&&e>=55&&e<65||"65+"===t&&e>=65)&&(a=!0)}),a||(o=!1)}if(o&&window.bragBookProcedureFilters.gender.length>0){const e=(t.dataset.gender||"").toLowerCase();window.bragBookProcedureFilters.gender.map(t=>t.toLowerCase()).includes(e)||(o=!1)}if(o&&window.bragBookProcedureFilters.ethnicity.length>0){const e=(t.dataset.ethnicity||"").toLowerCase();window.bragBookProcedureFilters.ethnicity.map(t=>t.toLowerCase()).includes(e)||(o=!1)}if(o&&window.bragBookProcedureFilters.height.length>0){const e=parseInt(t.dataset.height),a=t.dataset.heightUnit||"cm";let r=!1;window.bragBookProcedureFilters.height.forEach(o=>{"cm"===a?("Under 160cm"===o&&e<160||"160-169cm"===o&&e>=160&&e<170||"170-179cm"===o&&e>=170&&e<180||"180cm+"===o&&e>=180)&&(r=!0):o===t.dataset.heightFull&&(r=!0)}),r||(o=!1)}if(o&&window.bragBookProcedureFilters.weight.length>0){const e=parseInt(t.dataset.weight),a=t.dataset.weightUnit||"lbs";let r=!1;window.bragBookProcedureFilters.weight.forEach(o=>{"lbs"===a||"lb"===a?("Under 120 lbs"===o&&e<120||"120-149 lbs"===o&&e>=120&&e<150||"150-179 lbs"===o&&e>=150&&e<180||"180-209 lbs"===o&&e>=180&&e<210||"210+ lbs"===o&&e>=210)&&(r=!0):"kg"===a?("Under 55kg"===o&&e<55||"55-69kg"===o&&e>=55&&e<70||"70-84kg"===o&&e>=70&&e<85||"85kg+"===o&&e>=85)&&(r=!0):o===t.dataset.weightFull&&(r=!0)}),r||(o=!1)}t.style.display=o?"":"none",o&&a++});const o=t.length>0,r=0===a?"No procedures match the selected filters":`Showing ${a} of ${e.length} procedures`;let s=document.querySelector(".brag-book-gallery-filter-results");if(!s){s=document.createElement("div"),s.className="brag-book-gallery-filter-results";const t=document.querySelector(".brag-book-gallery-case-grid")||document.querySelector(".brag-book-gallery-case-grid");t&&t.parentNode&&t.parentNode.insertBefore(s,t)}s.textContent=r,s.style.display=o?"block":"none";const i=document.getElementById("procedure-filters-details");if(i){i.open=!1;const t=i.querySelector(".brag-book-gallery-filter-dropdown__toggle");t&&t.classList.toggle("has-active-filters",o)}const n=document.querySelector('button[onclick*="loadMoreCases"]')||document.querySelector(".brag-book-gallery-load-more button"),l=n?n.closest(".brag-book-gallery-load-more-container")||n.parentElement:null;l&&(o||0===a?l.style.display="none":n.hasAttribute("data-start-page")&&(l.style.display=""))}},window.loadFilteredCases=function(t){const e=document.querySelectorAll('.brag-book-gallery-case-card[data-card="true"]');e.forEach(t=>{t.style.display="none"});let a=0,o=[];if(t.forEach(t=>{const e=document.querySelector(`.brag-book-gallery-case-card[data-case-id="${t}"]`);e?(e.style.display="",a++):o.push(t)}),o.length>0){const t=document.querySelector(".brag-book-gallery-case-grid")||document.querySelector(".brag-book-gallery-case-grid");if(t){const e=document.createElement("div");e.className="filter-loading-message",e.textContent=`Loading ${o.length} additional matching cases...`,e.style.cssText="padding: 20px; text-align: center; font-style: italic;",t.appendChild(e);const r=new FormData;r.append("action","brag_book_load_filtered_cases"),r.append("case_ids",o.join(",")),r.append("nonce","undefined"!=typeof bragBookAjax?bragBookAjax.nonce:""),fetch("undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php",{method:"POST",body:r}).then(t=>t.json()).then(e=>{const o=t.querySelector(".filter-loading-message");if(o&&o.remove(),e.success&&e.data.html){const o=document.createElement("div");o.innerHTML=e.data.html,o.querySelectorAll(".brag-book-gallery-case-card").forEach(e=>{t.appendChild(e),a++})}updateFilteredCount(a,window.bragBookCompleteDataset.length)}).catch(e=>{console.error("Error loading filtered cases:",e);const a=t.querySelector(".filter-loading-message");a&&(a.textContent="Failed to load additional cases. Showing only currently loaded matches.",setTimeout(()=>a.remove(),3e3))})}}else updateFilteredCount(a,window.bragBookCompleteDataset?window.bragBookCompleteDataset.length:e.length);const r=document.querySelector('button[onclick*="loadMoreCases"]')||document.querySelector(".brag-book-gallery-load-more button"),s=r?r.closest(".brag-book-gallery-load-more-container")||r.parentElement:null;s&&(s.style.display="none")},window.updateFilteredCount=function(t,e){const a=document.querySelector(".brag-book-gallery-favorite-count-label")||document.querySelector(".cases-count");a&&(a.textContent=`Showing ${t} of ${e}`);let o=document.querySelector(".brag-book-gallery-filter-results");if(!o){o=document.createElement("div"),o.className="brag-book-gallery-filter-results";const t=document.querySelector(".brag-book-gallery-case-grid")||document.querySelector(".brag-book-gallery-case-grid");t&&t.parentNode&&t.parentNode.insertBefore(o,t)}0===t?(o.textContent="No procedures match the selected filters",o.style.display="block"):window.bragBookProcedureFilters&&Object.values(window.bragBookProcedureFilters).some(t=>t.length>0)?(o.textContent=`Filter applied: Showing ${t} matching procedures`,o.style.display="block"):o.style.display="none"},window.clearProcedureFilters=function(){document.querySelectorAll(".brag-book-gallery-filter-option input").forEach(t=>{t.checked=!1}),document.querySelectorAll('.brag-book-gallery-case-card[data-card="true"]').forEach(t=>{t.style.display=""});const t=document.querySelector(".brag-book-gallery-filter-results");t&&(t.style.display="none"),window.bragBookProcedureFilters={age:[],gender:[],ethnicity:[],height:[],weight:[]};const e=document.querySelector(".brag-book-gallery-filter-dropdown__toggle");e&&e.classList.remove("has-active-filters");const a=document.querySelector('[data-action="filter-badges"]');a&&(a.innerHTML=""),document.querySelectorAll(".brag-book-gallery-filter-badge").forEach(t=>{t.remove()});const o=document.querySelector('[data-action="clear-filters"]');o&&(o.style.display="none"),window.bragBookGalleryApp&&"function"==typeof window.bragBookGalleryApp.updateDemographicBadges&&window.bragBookGalleryApp.updateDemographicBadges({age:[],gender:[],ethnicity:[],height:[],weight:[]}),"function"==typeof window.updateDemographicFilterBadges&&window.updateDemographicFilterBadges({age:[],gender:[],ethnicity:[],height:[],weight:[]});const r=document.querySelector('button[onclick*="loadMoreCases"]')||document.querySelector(".brag-book-gallery-load-more button"),s=r?r.closest(".brag-book-gallery-load-more-container")||r.parentElement:null;s&&r&&r.hasAttribute("data-start-page")&&(s.style.display="")},window.syncImageHeights=function(t){t.style.opacity="1";const e=t.closest(".brag-book-gallery-image-container");if(e){const t=e.querySelector(".brag-book-gallery-skeleton-loader");t&&(t.style.display="none")}const a=t.closest(".brag-book-gallery-case-images");if(!a)return;const o=a.querySelectorAll("img");let r=!0;if(o.forEach(t=>{t.complete&&t.naturalHeight||(r=!1)}),!r)return;let s=0;o.forEach(t=>{const e=t.naturalHeight/t.naturalWidth;e>s&&(s=e)}),a.querySelectorAll(".brag-book-gallery-image-container").forEach(t=>{t.style.paddingBottom=100*s+"%"})},window.loadCaseDetails=function(t,e,a,o){window.loadCaseDetailsWithName(t,e,a,"",o)},window.loadCaseDetailsWithName=function(t,e,a,o,r){const s=document.getElementById("gallery-content");if(!s)return void console.error("Gallery content container not found");if(!r){const e=document.querySelector(`.brag-book-gallery-case-card[data-case-id="${t}"]`);e&&e.dataset.procedureIds&&(r=e.dataset.procedureIds)}if(s.innerHTML='<div class="brag-book-gallery-loading">Loading case details...</div>',a&&window.history&&window.history.pushState){const o=document.querySelector(".brag-book-gallery-wrapper");let r=o?.dataset.baseUrl||window.location.pathname;if(r=r.replace(/\/[^\/]+\/\d+\/?$/,""),r=r.replace(/\/[^\/]+\/?$/,""),r=r.replace(/\/$/,""),!r||""===r){const t=window.location.pathname.split("/").filter(t=>t);r=t.length>0?"/"+t[0]:""}const s=`${r}/${a}/${t}`;window.history.pushState({caseId:t,procedureId:e,procedureSlug:a},"",s)}const i={action:"load_case_details",case_id:t,nonce:bragBookGalleryConfig.nonce};e&&(i.procedure_id=e),a&&(i.procedure_slug=a),o&&(i.procedure_name=o),r&&(i.procedure_ids=r),fetch(bragBookGalleryConfig.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(i)}).then(t=>t.json()).then(t=>{if(t.success){s.innerHTML=t.data.html;const e=document.querySelector(".brag-book-gallery-wrapper");e?e.scrollIntoView({behavior:"smooth",block:"start"}):s.scrollIntoView({behavior:"smooth",block:"start"})}else s.innerHTML='<div class="brag-book-gallery-error">Failed to load case details: '+(t.data||"Unknown error")+"</div>"}).catch(t=>{console.error("Error loading case details:",t),s.innerHTML='<div class="brag-book-gallery-error">Error loading case details. Please try again.</div>'})},window.loadMoreCases=function(t){t.disabled=!0;const e=t.textContent;t.textContent="Loading...";const a=t.getAttribute("data-start-page"),o=t.getAttribute("data-procedure-ids"),r=t.getAttribute("data-procedure-name")||"";let s=!1;const i=document.querySelector(".brag-book-gallery-nav-link.brag-book-gallery-active");i&&"true"===i.dataset.nudity&&(s=!0);const n=document.querySelectorAll("[data-case-id]"),l=Array.from(n).map(t=>t.getAttribute("data-case-id")).filter(Boolean),c=window.bragBookGalleryConfig?.nonce||"",d=window.bragBookGalleryConfig?.ajaxUrl||"/wp-admin/admin-ajax.php",h=new FormData;h.append("action","brag_book_load_more_cases"),h.append("nonce",c),h.append("start_page",a),h.append("procedure_ids",o),h.append("procedure_name",r),h.append("has_nudity",s?"1":"0"),h.append("loaded_ids",l.join(",")),fetch(d,{method:"POST",body:h}).then(t=>t.json()).then(o=>{if(o.success){let r=document.querySelector(".brag-book-gallery-case-grid");if(r||(r=document.querySelector(".brag-book-gallery-cases-container")),r||(r=document.querySelector(".brag-book-gallery-case-grid .brag-book-gallery-cases-container")),r)if(o.data.html){const t=r.querySelector(".brag-book-gallery-case-card:last-child");t?t.insertAdjacentHTML("afterend",o.data.html):r.insertAdjacentHTML("beforeend",o.data.html)}else console.error("No HTML received from server");else console.error("Container not found (.brag-book-gallery-case-grid, .brag-book-gallery-cases-container, or .brag-book-gallery-case-grid .brag-book-gallery-cases-container)");const s=o.data.casesLoaded||0;if(o.data.hasMore&&s>0)t.setAttribute("data-start-page",parseInt(a)+1),t.disabled=!1,t.textContent=e;else{const e=t.closest(".brag-book-gallery-load-more-container")||t.parentElement;e&&(e.style.display="none")}if(r){const t=document.querySelector(".brag-book-gallery-favorite-count-label")||document.querySelector(".cases-count")||document.querySelector('[class*="count-label"]');if(t){const e=r.querySelectorAll(".brag-book-gallery-case-card").length,a=t.textContent.match(/(\d+) of (\d+)/);if(a){const o=a[2];t.textContent="Showing "+e+" of "+o}}}}else console.error("Failed to load more cases:",o.data?o.data.message:"Unknown error"),t.disabled=!1,t.textContent=e,alert("Failed to load more cases. Please try again.")}).catch(a=>{console.error("Error loading more cases:",a),t.disabled=!1,t.textContent=e,alert("Error loading more cases. Please check your connection and try again.")})},window.bragBookSetImageAspectRatio=function(t){const e=t.naturalWidth,a=t.naturalHeight;if(e&&a){const o=e+"/"+a,r=t.closest(".brag-book-gallery-image-container, .brag-book-gallery-thumb-image");r&&(r.style.aspectRatio=o,r.style.width="100%",r.style.height="auto",r.style.minHeight="auto",r.style.maxHeight="none",t.style.width="100%",t.style.height="100%",t.style.objectFit="contain",r.removeAttribute("data-image-loading"))}},window.initInfiniteScroll=function(){if("yes"!==window.bragBookGalleryConfig?.infiniteScroll)return;let t,e=!1;const a=()=>{clearTimeout(t),t=setTimeout(()=>{if(e)return;const t=document.querySelector('button[onclick*="loadMoreCases"]')||document.querySelector(".brag-book-gallery-load-more button");if(!t||t.disabled||"none"===t.style.display)return;const a=t.closest(".brag-book-gallery-load-more-container");a&&"none"===a.style.display||window.innerHeight+window.scrollY>=document.documentElement.offsetHeight-800&&(e=!0,t.click(),setTimeout(()=>{e=!1},1e3))},100)};window.addEventListener("scroll",a,{passive:!0}),window.addEventListener("resize",a,{passive:!0}),window.infiniteScrollHandler=a},document.addEventListener("DOMContentLoaded",()=>{new c,d=new n,h=new l;const t=document.querySelector(".brag-book-gallery-case-grid");if(t&&(setTimeout(()=>{t.classList.add("grid-initialized")},1e3),window.innerWidth>=1024)){const e=localStorage.getItem("bragbook-grid-columns");if(e){const a=parseInt(e);t.setAttribute("data-columns",a),document.querySelectorAll(".brag-book-gallery-grid-btn").forEach(t=>{parseInt(t.dataset.columns)===a?t.classList.add("active"):t.classList.remove("active")})}else t.setAttribute("data-columns","3")}initInfiniteScroll()}),document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){!window.bragBookCompleteDataset&&window.bragBookGalleryConfig&&window.bragBookGalleryConfig.completeDataset&&(window.bragBookCompleteDataset=window.bragBookGalleryConfig.completeDataset),initializeProcedureFilters();const t=document.querySelector(".brag-book-gallery-wrapper");if(t&&t.dataset.initialCaseId){const e=t.dataset.initialCaseId,a=window.location.pathname.split("/").filter(t=>t),o=a.length>2?a[a.length-2]:"";let r="";const s=document.querySelector(`.brag-book-gallery-nav-link[data-procedure="${o}"]`);if(s){const t=s.querySelector(".brag-book-gallery-filter-option-label");t&&(r=t.textContent.trim())}if(!r&&window.bragBookGalleryConfig&&window.bragBookGalleryConfig.sidebarData){const t=window.bragBookGalleryConfig.sidebarData;for(const e of Object.values(t)){if(e.procedures)for(const t of e.procedures)if(t.slug===o){r=t.name;break}if(r)break}}let i="";setTimeout(()=>{const t=document.querySelector(`.brag-book-gallery-case-card[data-case-id="${e}"]`);t&&t.dataset.procedureIds&&(i=t.dataset.procedureIds),window.loadCaseDetailsWithName(e,"",o,r,i)},200)}},100)}),document.addEventListener("toggle",function(t){if("procedure-filters-details"===t.target.id){const e=t.target;e.open&&!e.dataset.initialized&&(generateProcedureFilterOptions(),e.dataset.initialized="true")}}),document.addEventListener("click",function(t){const e=document.getElementById("procedure-filters-details"),a=document.querySelector(".brag-book-gallery-filter-dropdown__panel");e&&e.open&&a&&(e.contains(t.target)||a.contains(t.target)||(e.open=!1))})}();