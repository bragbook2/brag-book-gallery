!function(){"use strict";class t{constructor(t,e={}){this.container=t,this.track=t.querySelector(".carousel-track"),this.items=Array.from(t.querySelectorAll(".carousel-item")),this.prevBtn=t.querySelector(".carousel-controls.prev"),this.nextBtn=t.querySelector(".carousel-controls.next"),this.pagination=t.querySelector(".carousel-pagination"),this.dots=Array.from(t.querySelectorAll(".carousel-dot")),this.options={autoPlay:!1!==e.autoPlay,autoPlayInterval:parseInt(e.autoPlayInterval)||5e3,showControls:!1!==e.showControls,showPagination:!1!==e.showPagination,itemsPerView:parseInt(e.itemsPerView)||this.calculateItemsPerView(),gap:parseInt(e.gap)||16,touchEnabled:!1!==e.touchEnabled,keyboard:!1!==e.keyboard,loop:!1!==e.loop,...e},this.currentIndex=0,this.isTransitioning=!1,this.autoPlayTimer=null,this.touchStartX=0,this.touchEndX=0,this.init()}init(){this.track&&0!==this.items.length?(this.setupLayout(),this.bindEvents(),this.updateNavigation(),this.options.autoPlay&&this.startAutoPlay(),this.container.classList.add("carousel-initialized"),this.dispatchEvent("carouselReady",{carousel:this})):console.warn("BRAG Book Carousel: Invalid carousel structure")}setupLayout(){const t=this.container.clientWidth,e=this.options.itemsPerView,s=this.options.gap,i=(t-s*(e+1))/e;this.items.forEach(t=>{t.style.width=`${i}px`,t.style.marginRight=`${s}px`}),this.items.length>0&&(this.items[this.items.length-1].style.marginRight="0");const o=this.items.length*(i+s);this.track.style.width=`${o}px`}calculateItemsPerView(){const t=this.container.clientWidth;return t<480?1:t<768?2:t<1024?3:4}bindEvents(){this.prevBtn&&this.options.showControls&&this.prevBtn.addEventListener("click",()=>this.goToPrevious()),this.nextBtn&&this.options.showControls&&this.nextBtn.addEventListener("click",()=>this.goToNext()),this.dots.length>0&&this.options.showPagination&&this.dots.forEach((t,e)=>{t.addEventListener("click",()=>this.goToSlide(e))}),this.options.touchEnabled&&(this.track.addEventListener("touchstart",t=>this.handleTouchStart(t),{passive:!0}),this.track.addEventListener("touchend",t=>this.handleTouchEnd(t),{passive:!0})),this.options.keyboard&&(this.container.addEventListener("keydown",t=>this.handleKeydown(t)),this.container.setAttribute("tabindex","0")),this.options.autoPlay&&(this.container.addEventListener("mouseenter",()=>this.pauseAutoPlay()),this.container.addEventListener("mouseleave",()=>this.startAutoPlay())),window.addEventListener("resize",()=>this.handleResize()),document.addEventListener("visibilitychange",()=>{document.hidden?this.pauseAutoPlay():this.options.autoPlay&&this.startAutoPlay()}),this.setupLazyLoading()}handleTouchStart(t){this.touchStartX=t.touches[0].clientX,this.pauseAutoPlay()}handleTouchEnd(t){this.touchEndX=t.changedTouches[0].clientX,this.handleSwipe(),this.options.autoPlay&&this.startAutoPlay()}handleSwipe(){const t=this.touchStartX-this.touchEndX;Math.abs(t)>50&&(t>0?this.goToNext():this.goToPrevious())}handleKeydown(t){switch(t.key){case"ArrowLeft":t.preventDefault(),this.goToPrevious();break;case"ArrowRight":t.preventDefault(),this.goToNext();break;case"Home":t.preventDefault(),this.goToSlide(0);break;case"End":t.preventDefault(),this.goToSlide(this.getMaxIndex())}}handleResize(){clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(()=>{this.options.itemsPerView=this.calculateItemsPerView(),this.setupLayout(),this.updateTransform(),this.updateNavigation()},250)}goToPrevious(){if(this.isTransitioning)return;const t=this.currentIndex-this.options.itemsPerView;t<0?this.options.loop&&this.goToSlide(this.getMaxIndex()):this.goToSlide(t)}goToNext(){if(this.isTransitioning)return;const t=this.currentIndex+this.options.itemsPerView;t>this.getMaxIndex()?this.options.loop&&this.goToSlide(0):this.goToSlide(t)}goToSlide(t){if(this.isTransitioning||t===this.currentIndex)return;const e=this.getMaxIndex();this.currentIndex=Math.max(0,Math.min(t,e)),this.updateTransform(),this.updateNavigation(),this.updatePagination(),this.dispatchEvent("slideChange",{currentIndex:this.currentIndex,carousel:this})}getMaxIndex(){return Math.max(0,this.items.length-this.options.itemsPerView)}updateTransform(){if(!this.track)return;this.isTransitioning=!0,this.track.classList.add("transitioning");const t=this.items[0]?.clientWidth||0,e=this.options.gap,s=this.currentIndex*(t+e);this.track.style.transform=`translateX(-${s}px)`,setTimeout(()=>{this.isTransitioning=!1,this.track.classList.remove("transitioning")},500)}updateNavigation(){if(!this.options.showControls)return;const t=this.getMaxIndex();this.prevBtn&&(this.prevBtn.disabled=!this.options.loop&&0===this.currentIndex),this.nextBtn&&(this.nextBtn.disabled=!this.options.loop&&this.currentIndex>=t)}updatePagination(){this.options.showPagination&&0!==this.dots.length&&this.dots.forEach((t,e)=>{const s=e===Math.floor(this.currentIndex/this.options.itemsPerView);t.classList.toggle("active",s)})}startAutoPlay(){this.options.autoPlay&&(this.pauseAutoPlay(),this.autoPlayTimer=setInterval(()=>{this.goToNext()},this.options.autoPlayInterval))}pauseAutoPlay(){this.autoPlayTimer&&(clearInterval(this.autoPlayTimer),this.autoPlayTimer=null)}setupLazyLoading(){const t=this.container.querySelectorAll("img[data-src]");if("IntersectionObserver"in window){const e=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting){const s=t.target;s.src=s.dataset.src,s.removeAttribute("data-src"),s.classList.remove("loading"),e.unobserve(s)}})});t.forEach(t=>{t.classList.add("loading"),e.observe(t)})}else t.forEach(t=>{t.src=t.dataset.src,t.removeAttribute("data-src")})}dispatchEvent(t,e){const s=new CustomEvent(`bragbook:${t}`,{detail:e,bubbles:!0});this.container.dispatchEvent(s)}destroy(){this.pauseAutoPlay(),window.removeEventListener("resize",this.handleResize),document.removeEventListener("visibilitychange",this.visibilityChangeHandler),this.resizeTimer&&clearTimeout(this.resizeTimer),this.dispatchEvent("carouselDestroy",{carousel:this})}}function e(){document.querySelectorAll(".brag-book-carousel").forEach(e=>{if(e.classList.contains("carousel-initialized"))return;const s={autoPlay:"false"!==e.dataset.autoPlay,autoPlayInterval:parseInt(e.dataset.autoPlayInterval)||5e3,showControls:"false"!==e.dataset.showControls,showPagination:"false"!==e.dataset.showPagination,itemsPerView:parseInt(e.dataset.itemsPerView)||null,touchEnabled:"false"!==e.dataset.touchEnabled,keyboard:"false"!==e.dataset.keyboard,loop:"false"!==e.dataset.loop},i=new t(e,s);e.bragBookCarousel=i})}window.BRAG BookCarousel={init:e,create:(e,s)=>new t(e,s),destroyAll:()=>{document.querySelectorAll(".brag-book-carousel").forEach(t=>{t.bragBookCarousel&&t.bragBookCarousel.destroy()})}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e(),window.MutationObserver&&new MutationObserver(e=>{e.forEach(e=>{"childList"===e.type&&e.addedNodes.forEach(e=>{if(1===e.nodeType){const s=e.classList?.contains("brag-book-carousel")?[e]:e.querySelectorAll?.(".brag-book-carousel")||[];Array.from(s).forEach(e=>{if(!e.classList.contains("carousel-initialized")){const s={autoPlay:"false"!==e.dataset.autoPlay,autoPlayInterval:parseInt(e.dataset.autoPlayInterval)||5e3,showControls:"false"!==e.dataset.showControls,showPagination:"false"!==e.dataset.showPagination,touchEnabled:"false"!==e.dataset.touchEnabled,keyboard:"false"!==e.dataset.keyboard,loop:"false"!==e.dataset.loop};e.bragBookCarousel=new t(e,s)}})}})})}).observe(document.body,{childList:!0,subtree:!0})}();
